// ==UserScript==
// @name           CerealOgameStats
// @description    Make alliance stats from ogame to post in forums
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/134405.user.js
// @updateURL      https://userscripts.org/scripts/source/134405.meta.js
// @icon           http://s3.amazonaws.com/uso_ss/icon/134405/large.png
// @version        1.11.10
// @include        *://*.ogame.*/game/index.php?*page=alliance*
// ==/UserScript==
/*!

	CerealOgameStats

	Makes alliance stats from the ogame alliance memberdata and
	transforms it into a forum friendly code.

	Copyright (C) 2012 Elías Grande Cásedas

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see http://www.gnu.org/licenses/

*/
(function(){var a={name:"CerealOgameStats",home:"http://userscripts.org/scripts/show/134405"};String.prototype.replaceAll=function(e,j){return this.split(e).join(j)};var d=function(m,n,l,j){if(j==0){return m.split(n[0]).join(l[0])}var k,e;e=m.split(n[j]);for(k in e){e[k]=d(e[k],n,l,j-1)}return e.join(l[j])};String.prototype.replaceMap=function(e){var j,m,l,k;m=new Array();l=new Array();k=0;for(j in e){m.push(j);l.push(e[j]);k++}if(k==0){return this}else{return d(this,m,l,k-1)}};String.prototype.trimNaN=function(){return this.replace(/^\D*(\d)/,"$1").replace(/(\d)\D*$/,"$1")};var h=window,g;try{if(unsafeWindow){h=unsafeWindow}}catch(f){}g=h.document;var c=function(){var p=function(){this.getMeta("version","ogame-version",null);this.getMeta("language","ogame-language","en");this.getMeta("timestamp","ogame-timestamp",null);this.getMeta("universe","ogame-universe",null);this.getMeta("alliance_id","ogame-alliance-id",null)};p.prototype={getMeta:function(A,B,C){try{this[A]=g.querySelector('meta[name="'+B+'"]').getAttribute("content")}catch(D){this[A]=C}}};var n=new p();var w={id:function(A){return a.name+"_"+n.universe+"_"+n.alliance_id+"_"+A},set:function(D,A){var B=this.id(D);try{h.localStorage.setItem(B,A)}catch(C){h.localStorage[B]=A}return A},get:function(D){var A=this.id(D);try{return h.localStorage.getItem(A)}catch(B){var C=h.localStorage[A];return(C=="undefined")?null:C}}};var r=function(){this.lc={}};r.prototype={get:function(A){if(this.lc[A]){return this.lc[A]}return A},set:function(B){for(var A in B){this.lc[A]=B[A]}},number:function(F){var E,A,D,B;E=F+"";A=E.split(".");D=A[0];B=A.length>1?this.lc.s_dec+A[1]:"";var C=/(\d+)(\d{3})/;while(C.test(D)){D=D.replace(C,"$1"+this.lc.s_tho+"$2")}return D+B},date:function(A){return A.trimNaN().split(/\D+/).join(this.lc.s_dat)},time:function(A){return A.trimNaN().split(/\D+/).join(this.lc.s_tim)},period:function(G){var B,F,E,A,D=parseInt(G),C="",H=0;B=Math.floor(D/604800);D-=B*604800;F=Math.floor(D/86400);D-=F*86400;E=Math.floor(D/3600);D-=E*3600;A=Math.floor(D/60);D-=A*60;if(B>0){C+=this.number(B)+this.lc.a_wee+" ";H++}if(F>0){C+=this.number(F)+this.lc.a_day+" ";H++}if(E>0||H<1||A+D<1){C+=this.number(E)+this.lc.a_hou+" ";H++}if(A>0||H<2||(H==2&&D<1)){C+=this.number(A)+this.lc.a_min+" ";H++}if(D>0||H<3){C+=this.number(D)+this.lc.a_sec}return C.trim()}};var q=new r();var z=function(A){return q.get(A)};q.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"w",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Select",b_del:"Erase",b_get:"Get from this page",b_sav:'Save as "Old data"',b_loa:"Load saved data",t_odt:"Old data",t_ndt:"New data",t_fmt:"Format",t_col:"Colors",t_inc:"Include",t_out:"Statistics (code)",t_stb:"Status",t_pre:'Preview (using "Dark background" colors)',p_ago:"{period} ago",p_now:"now",c_dbg:"Dark background",c_lbg:"Light background",e_nod:"No old data",e_nnd:"No new data",e_odf:"The old data has wrong format",e_ndf:"The new data has wrong format",e_unk:"Unexpected error",e_ndt:"No data",e_wft:"Wrong format",w_dne:"Done",w_pcs:"Processing",o_tdt:"Evolution of the alliance since {oldDate} to {newDate}",o_tet:"Elapsed time",o_tas:"Alliance summary",o_ptl:"Total points",o_ppm:"Points per member",o_tts:"Top 3 by score",o_ttp:"Top 3 by percent",o_trs:"Score rank",o_trp:"Percent rank",o_tsc:"Special cases",o_cnm:"new member",o_cla:"leaves the alliance",o_bdg:"banned",o_bdq:"unbanned",o_ldt:"Latest data (for future statistics)",o_abt:"Statistics performed with {link}"});if(/es|ar|mx/.test(n.language)){q.set({s_dec:",",s_tho:".",a_wee:"s",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Seleccionar",b_del:"Borrar",b_get:"Obtener de esta página",b_sav:'Guardar como "Datos antiguos"',b_loa:"Cargar datos guardados",t_odt:"Datos antiguos",t_ndt:"Datos nuevos",t_fmt:"Formato",t_col:"Colores",t_inc:"Incluir",t_out:"Estadísticas (código)",t_stb:"Estado",t_pre:'Previsualización (usando colores de "Fondo oscuro")',p_ago:"hace {period}",p_now:"ahora",c_dbg:"Fondo oscuro",c_lbg:"Fondo claro",e_nod:"No hay datos antiguos",e_nnd:"No hay datos nuevos",e_odf:"Los datos antiguos tienen un formato erróneo",e_ndf:"Los datos nuevos tienen un formato erróneo",e_unk:"Error inesperado",e_ndt:"Sin datos",e_wft:"Formato erróneo",w_dne:"Terminado",w_pcs:"Procesando",o_tdt:"Evolución de la alianza desde el {oldDate} hasta el {newDate}",o_tet:"Tiempo transcurrido",o_tas:"Resumen de la alianza",o_ptl:"Puntos totales",o_ppm:"Puntos por miembro",o_tts:"Top 3 por puntos",o_ttp:"Top 3 por porcentaje",o_trs:"Ranking por puntos",o_trp:"Ranking por porcentaje",o_tsc:"Casos especiales",o_cnm:"nuevo miembro",o_cla:"abandona la alianza",o_bdg:"baneado",o_bdq:"desbaneado",o_ldt:"Datos más recientes (para futuras estadísticas)",o_abt:"Estadísticas realizadas con {link}"})}var y=function(){this.names=new Array();this.colors=new Array();this.selected=null};y.prototype={add:function(B,A){this.names.push(B);this.colors.push(A)},select:function(A){this.selected=this.colors[A]},replace:function(A){return A.replaceMap(this.selected)}};var o=new y();o.add(z("c_dbg"),{"{nameColor}":"white","{growsColor}":"#00FF40","{decreasesColor}":"#ED7010","{remainsColor}":"#00DDDD"});o.add(z("c_lbg"),{"{nameColor}":"purple","{growsColor}":"green","{decreasesColor}":"red","{remainsColor}":"blue"});var l={diffScore:function(A,D){var C=D-A;var B=((D/A)-1)*100;return{score:C,percent:B}}};var j=function(){this.formats=new Array();this.selected=null;this.escapeMap={"[":"[[u][/u]","]":"[u][/u]]"};this.lastReplace={"{grows}":"\u00BB","{decreases}":"\u00AB","{remains}":"\u007E","{remainsNo}":"\u00D8","{up}":"\u2191","{down}":"\u2193","{rank}":"#","{\\":"{","\\}":"}"};this.layout={sectionStart:"[size=big]{title}[/size]",sectionEnd:"\n\n",dateTime:"{date} ([i]{time}[/i])",header:"[b]{title}[/b]\n{elapsedTitle}: {elapsedTime}\n\n",allianceLine:"\n[color={diffColor}]{diff}[/color] [b][color={nameColor}]{title}[/color][/b] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",top3ScoreLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffScore}[/color][/b])",top3PercentLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",rankLine:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",rank:" [size=small]{rank}[/size]{newPos} ([b][color={diffColor}]{diffPos}[/color][/b])",rankNoDiff:" [size=small]{rank}[/size]{newPos} ([b][color={remainsColor}]{remainsNo}[/color][/b])",rankLineNoDiff:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {oldScore} ([b][color={remainsColor}]{remainsNo}[/color][/b])",from0Member:"\n[color={growsColor}]{grows} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={growsColor}]{score}[/color][/b] [size=small]({reason})[/size]",to0Member:"\n[color={decreasesColor}]{decreases} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={decreasesColor}]{score}[/color][/b] [size=small]({reason})[/size]",scriptData:"\n[i]{scriptDataTitle}:[/i]\n[spoiler][code]{scriptData}[/code][/spoiler]",scriptLink:"\n[i]"+z("o_abt").replace("{link}","[url={scriptHome}]{scriptName}[/url]")+"[/i]"}};j.prototype={add:function(A,B){this.formats.push({name:A,patterns:B,escapeMap:(arguments.length>2)?arguments[2]:false})},select:function(A){this.selected=this.formats[A]},escape:function(A){if(this.selected.escapeMap){return A.replaceMap(this.selected.escapeMap)}else{return A.replaceMap(this.escapeMap)}},diff:function(B,C){var A=B;if(C<0){A=A.replaceMap({"{diffColor}":"{decreasesColor}","{diff}":"{decreases}"})}else{if(C>0){A=A.replaceMap({"{diffColor}":"{growsColor}","{diff}":"{grows}"})}else{A=A.replaceMap({"{diffColor}":"{remainsColor}","{diff}":"{remains}"})}}return A},header:function(A){return this.layout.header.replaceMap({"{title}":z("o_tdt").replaceMap({"{oldDate}":this.layout.dateTime.replaceMap({"{date}":A.oldDate,"{time}":A.oldTime}),"{newDate}":this.layout.dateTime.replaceMap({"{date}":A.newDate,"{time}":A.newTime})}),"{elapsedTitle}":z("o_tet"),"{elapsedTime}":this.escape(q.period(A.newTimestamp-A.oldTimestamp))})},alliance:function(A){if(A.oldScore==0){return""}return this.layout.sectionStart.replaceAll("{title}",z("o_tas"))+this.diff(this.layout.allianceLine,A.diffScore).replaceMap({"{title}":z("o_ptl"),"{newScore}":A.formatted.newScore,"{diffScore}":A.formatted.diffScore,"{diffPercent}":A.formatted.diffPercent})+this.diff(this.layout.allianceLine,A.diffMemberScore).replaceMap({"{title}":z("o_ppm"),"{newScore}":A.formatted.newMemberScore,"{diffScore}":A.formatted.diffMemberScore,"{diffPercent}":A.formatted.diffMemberPercent})+this.layout.sectionEnd},position:function(F,A){var B=F+"",E=(B).length,D=(A+"").length;for(var C=E;C<D;C++){B="0"+B}return B},top3:function(D,F,H,A){var C=(this.layout.sectionStart+"").replace("{title}",H);var B=Math.min(D.length,3);var E,G;for(E=0;E<B;E++){G=D[E];C=C+this.diff(A,G.diffScore).replaceMap({"{position}":this.position(E+1,B),"{name}":this.escape(G.name)}).replaceAll("{"+F+"}",G.formatted[F])}return C+this.layout.sectionEnd},rank:function(C,G){var B=(this.layout.sectionStart+"").replace("{title}",G);var A=C.length;var D,F;for(D=0;D<A;D++){F=C[D];var E=(F.diffScore==0)?this.layout.rankLineNoDiff:this.layout.rankLine;B=B+this.diff(E,F.diffScore).replaceMap({"{position}":this.position(D+1,A),"{name}":this.escape(F.name),"{oldScore}":F.formatted.oldScore,"{newScore}":F.formatted.newScore,"{diffScore}":F.formatted.diffScore,"{diffPercent}":F.formatted.diffPercent});E=(F.diffPos==0)?this.layout.rankNoDiff:this.layout.rank;B=B+this.diff(E,F.diffPos).replaceMap({"{newPos}":F.formatted.newPos,"{diffPos}":F.formatted.diffPos.replaceMap({"+":"{up}","-":"{down}"})})}return B+this.layout.sectionEnd},specialCases:function(C,D){if((C.length+D.length)==0){return""}var A=this.layout.sectionStart.replace("{title}",z("o_tsc"));var B,E;for(B in D){E=D[B];A=A+this.layout.from0Member.replaceMap({"{name}":this.escape(E.name),"{score}":E.score,"{reason}":E.reason})}for(B in C){E=C[B];A=A+this.layout.to0Member.replaceMap({"{name}":this.escape(E.name),"{score}":E.score,"{reason}":E.reason})}return A+this.layout.sectionEnd},format:function(B,D,I,E,H,F){var C=this.header(D);if(B.alliance){C=C+this.alliance(D)}var G="";var J="";var A="";var K="";if(I.length>0){I=I.sort(function(M,L){return(M.diffScore>=L.diffScore)?-1:1});if(B.top3Score&&(I.length>5||!B.score)){G=this.top3(I,"diffScore",z("o_tts"),this.layout.top3ScoreLine)}if(B.score){A=this.rank(I,z("o_trs"))}I=I.sort(function(M,L){return(M.diffPercent>=L.diffPercent)?-1:1});if(B.top3Percent&&(I.length>5||!B.percent)){J=this.top3(I,"diffPercent",z("o_ttp"),this.layout.top3PercentLine)}if(B.percent){K=this.rank(I,z("o_trp"))}}C=C+G+J+A+K;if(B.special){C=C+this.specialCases(E,H)}if(B.data){C=C+this.layout.scriptData.replace("{scriptDataTitle}",z("o_ldt"))}C=C+this.layout.scriptLink;C=C.replaceMap(this.selected.patterns).replaceMap(o.selected).replaceMap({"{scriptName}":a.name,"{scriptHome}":a.home}).replaceMap(this.lastReplace).replace("{scriptData}",F.replaceMap({"<":"\\u003C",">":"\\u003E","[":"\\u005B","]":"\\u005D"}));return C.trim()}};var t=new j();t.add("phpBB",{"[size=big]":"[size=20]","[size=small]":"[size=10]"});t.add("phpBB3",{"[size=big]":"[size=140]","[size=small]":"[size=80]"});t.add("SMF",{"[size=big]":"[size=14pt]","[size=small]":"[size=7pt]"});t.add("vBulletin",{"[size=big]":"[size=4]","[size=small]":"[size=1]"});t.add("HTML",{"{grows}":"&raquo;","{decreases}":"&laquo;","{remains}":"&sim;","{remainsNo}":"&Oslash;","{up}":"&uarr;","{down}":"&darr;","[size=big]":'<span style="font-size: 140%;">',"[size=small]":'<span style="font-size: 80%;">',"[/size]":"</span>","[color={":'<span style="color: {',"Color}]":'Color}">',"[/color]":"</span>","[b]":"<b>","[/b]":"</b>","[i]":"<i>","[/i]":"</i>","\n":"<br />\n","[spoiler]":"<div>","[/spoiler]":"</div>","[code]":'<textarea onclick="this.select();" rows="5" cols="20">',"[/code]":"</textarea>","[url={scriptHome}]{scriptName}[/url]":'<a href="{scriptHome}">{scriptName}</a>'},{"&":"&amp;","<":"&lt;",">":"&gt;"});var v=function(){};v.prototype={reset:function(){this.allyInfo={oldCount:0,oldScore:0,newCount:0,newScore:0};this.membersInfo=new Array();this.oldMembersInfo=new Array();this.newMembersInfo=new Array();this.to0MembersInfo=new Array();this.from0MembersInfo=new Array()},readData:function(D,C){var A,B=JSON.parse(D);this.allyInfo[C+"Timestamp"]=B.timestamp;this.allyInfo[C+"Date"]=B.strDate;this.allyInfo[C+"Time"]=B.strTime;for(A in B.members){this[C+"MembersInfo"].push({id:("i" in B.members[A])?B.members[A].i:-1,name:A,score:B.members[A].s,pos:B.members[A].p,coord:B.members[A].c,date:B.members[A].d,noPartner:true});this.allyInfo[C+"Count"]++;this.allyInfo[C+"Score"]=this.allyInfo[C+"Score"]+B.members[A].s}return B},merge:function(){var F,D,I,C,E,A,G;I=this.allyInfo.oldCount;for(F in this.newMembersInfo){E=this.newMembersInfo[F];for(D=0;D<I;D++){C=this.oldMembersInfo[D];if((C.noPartner)&&(((C.id>=0)&&(C.id==E.id))||(C.name==E.name)||(C.coord==E.coord))){break}}if(D!=I){this.oldMembersInfo[D].noPartner=false;this.newMembersInfo[F].noPartner=false;if(E.score==0){this.to0MembersInfo.push({name:E.name,score:q.number(C.score),reason:z("o_bdg")})}else{if(C.score==0){this.from0MembersInfo.push({name:E.name,score:q.number(E.score),reason:z("o_bdq")})}else{G=l.diffScore(C.score,E.score);A={name:E.name,oldScore:C.score,newScore:E.score,oldPos:C.pos,newPos:E.pos,diffPos:C.pos-E.pos,diffScore:G.score,diffPercent:G.percent};A.formatted={oldScore:q.number(A.oldScore),newScore:q.number(A.newScore),oldPos:q.number(A.oldPos.toFixed()),newPos:q.number(A.newPos.toFixed()),diffPos:((A.diffPos<0)?"":"+")+q.number(A.diffPos.toFixed()),diffScore:((A.diffScore<0)?"":"+")+q.number(A.diffScore.toFixed()),diffPercent:((A.diffPercent<0)?"":"+")+q.number(A.diffPercent.toFixed(2))};this.membersInfo.push(A)}}}}var B,H;for(H in this.newMembersInfo){B=this.newMembersInfo[H];if(B.noPartner){this.from0MembersInfo.push({name:B.name,score:q.number(B.score),reason:z("o_cnm")})}}for(H in this.oldMembersInfo){B=this.oldMembersInfo[H];if(B.noPartner){this.to0MembersInfo.push({name:B.name,score:q.number(B.score),reason:z("o_cla")})}}this.to0MembersInfo.sort(function(K,J){return parseInt(K.score)-parseInt(J.score)});this.from0MembersInfo.sort(function(K,J){return parseInt(J.score)-parseInt(K.score)});delete this.oldMembersInfo;delete this.newMembersInfo;G=l.diffScore(this.allyInfo.oldScore,this.allyInfo.newScore);this.allyInfo.diffScore=G.score;this.allyInfo.diffPercent=G.percent;this.allyInfo.oldMemberScore=this.allyInfo.oldScore/this.allyInfo.oldCount;this.allyInfo.newMemberScore=this.allyInfo.newScore/this.allyInfo.newCount;G=l.diffScore(this.allyInfo.oldMemberScore,this.allyInfo.newMemberScore);this.allyInfo.diffMemberScore=G.score;this.allyInfo.diffMemberPercent=G.percent;this.allyInfo.formatted={oldScore:q.number(this.allyInfo.oldScore),newScore:q.number(this.allyInfo.newScore),diffScore:((this.allyInfo.diffScore<0)?"":"+")+q.number(this.allyInfo.diffScore.toFixed()),diffPercent:((this.allyInfo.diffPercent<0)?"":"+")+q.number(this.allyInfo.diffPercent.toFixed(2)),oldMemberScore:q.number(this.allyInfo.oldMemberScore.toFixed()),newMemberScore:q.number(this.allyInfo.newMemberScore.toFixed()),diffMemberScore:((this.allyInfo.diffMemberScore<0)?"":"+")+q.number(this.allyInfo.diffMemberScore.toFixed()),diffMemberPercent:((this.allyInfo.diffMemberPercent<0)?"":"+")+q.number(this.allyInfo.diffMemberPercent.toFixed(2))}},doIt:function(C){C.setStats();C.setPreview();t.select(parseInt(C.selectFormat.selectedIndex));o.select(parseInt(C.selectColors.selectedIndex));C.setOkStatus(z("w_pcs")+"...");this.reset();var D,F,B=false;if(C.oldList.value.trim()==""){C.setErrorStatus(z("e_nod"));C.setTitle("old",z("e_ndt"),false);B=true}if(!B){try{D=this.readData(C.oldList.value,"old");F=D.strDate+" (<i>"+D.strTime+"</i>) &rarr; "+((n.timestamp==D.timestamp)?z("p_now"):z("p_ago").replace("{period}",q.period(n.timestamp-D.timestamp)));if(this.oldMembersInfo.length==0||/NaN|undefined/.test(F)){throw 0}C.setTitle("old",F,true)}catch(E){C.setTitle("old",z("e_wft"),false);C.setErrorStatus(z("e_odf"));B=true}}if(C.newList.value.trim()==""){C.setErrorStatus(z("e_nnd"));C.setTitle("new",z("e_ndt"),false);return}try{D=this.readData(C.newList.value,"new");F=D.strDate+" (<i>"+D.strTime+"</i>) &rarr; "+((n.timestamp==D.timestamp)?z("p_now"):z("p_ago").replace("{period}",q.period(n.timestamp-D.timestamp)));if(this.newMembersInfo.length==0||/NaN|undefined/.test(F)){throw 0}C.setTitle("new",F,true);if(B){return}}catch(E){C.setErrorStatus(z("e_ndf"));return}try{this.merge();var A={alliance:C.doAlliance.checked,top3Score:C.doTop3Score.checked,top3Percent:C.doTop3Percent.checked,score:C.doScore.checked,percent:C.doPercent.checked,special:C.doSpecial.checked,data:C.doData.checked};C.setStats(t.format(A,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,C.newList.value.trim()));A.data=false;t.select(t.formats.length-1);o.select(0);C.setPreview(t.format(A,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,C.newList.value.trim()).replaceAll(t.selected.patterns["[size=small]"],"<span>").replaceAll(t.selected.patterns["[size=big]"],'<span style="font-size:20px">'));C.setOkStatus(z("w_dne"))}catch(E){C.setErrorStatus(z("e_unk")+": "+E)}}};var s=new v();var e=function(){};e.prototype={addTextarea:function(B){var A=g.createElement("textarea");A.setAttribute("cols","120");A.setAttribute("rows","40");A.setAttribute("class","textBox");B.appendChild(A);return A},addSelect:function(B){var A=g.createElement("select");A.setAttribute("class","dropdown");B.appendChild(A);return A},addOption:function(D,C,B){var A=g.createElement("option");A.appendChild(g.createTextNode(D));A.setAttribute("value",C);B.appendChild(A);return A},addAnchor:function(B,C){var A=g.createElement("a");A.setAttribute("href","javascript:void(0);");A.appendChild(g.createTextNode(C));B.appendChild(A);return A},addTitle:function(B,C){var A=g.createElement("b");A.appendChild(g.createTextNode(C));A.setAttribute("style","display:block;font-size:12px");B.appendChild(A);return A},newCell:function(){var A=g.createElement("td");return A},addText:function(B,C){var A=g.createTextNode(C);B.appendChild(A);return A},addBr:function(A){A.appendChild(g.createElement("br"))},addEvent:function(C,B,A){C.addEventListener(B,A,false)},addOnChange:function(B,A){B.addEventListener("change",A,false);B.addEventListener("keyup",A,false)},addCheckbox:function(C,G,H,F,E){var A=g.createElement("input");A.setAttribute("type","checkbox");A.setAttribute("id",a.name+"_"+H);A.setAttribute("style","cursor:pointer;");C.appendChild(A);var B=g.createElement("label");B.setAttribute("for",a.name+"_"+H);B.setAttribute("style","cursor:pointer;");B.innerHTML="&nbsp;"+G;C.appendChild(B);this.addBr(C);var D=w.get(H);A.checked=(D==null)?F:(parseInt(D)==1);w.set(H,(A.checked)?1:0);A.addEventListener("change",function(){w.set(H,(A.checked)?1:0);E()},false);B.addEventListener("mouseover",function(){B.setAttribute("class","undermark")},false);B.addEventListener("mouseout",function(){B.removeAttribute("class")},false);return A},makeTogleable:function(E,I,F){var G=g.createElement("a");G.setAttribute("href","javascript:void(0);");G.setAttribute("class",a.name+"_toggle_button");var B=E;var A=true;var D=function(){A=true;B.removeAttribute("style");F.setAttribute("class",F.getAttribute("class").replace("_toggle_bar_open","_toggle_bar_close"))};var H=function(){A=false;B.setAttribute("style","display:none;");F.setAttribute("class",F.getAttribute("class").replace("_toggle_bar_close","_toggle_bar_open"))};var C=function(){if(A){H()}else{D()}};F.setAttribute("class",F.hasAttribute("class")?F.getAttribute("class")+" "+a.name+"_toggle_bar_close":a.name+"_toggle_bar_close");F.addEventListener("click",C,false);C();I.setAttribute("style","position:relative;");I.appendChild(G);return{open:D,close:H,toggle:C}},addCss:function(B){var D;D=B;var C=g.createElement("style");C.setAttribute("type","text/css");if(C.styleSheet){C.styleSheet.cssText=D}else{C.appendChild(g.createTextNode(D))}var A=g.getElementsByTagName("head")[0];A.appendChild(C)}};var u=new e();u.addCss("#"+a.name+" textarea{width: 350px !important;height: 70px !important;margin: 0 !important;padding: 5px !important;}#"+a.name+" a{display: block !important;padding: 5px 0 0 0 !important;}#"+a.name+" select{width: 250px !important;}#"+a.name+" td{padding: 5px !important;text-align: left !important;}#"+a.name+" td.col2{width: 364px !important;}#"+a.name+" tr.tit td{line-height: 18px !important;}#"+a.name+"_preview{color: #6F9FC8 !important;border-top: 2px dotted #242E38 !important;padding-top: 15px !important;}#"+a.name+"_preview a{display: inline !important;padding: 0 !important;}."+a.name+"_toggle_button{background-color: transparent !important;background-image: url('http://gf2.geo.gfsrv.net/cdn71/fc7a8ede3499a0b19ea17613ff0cb1.gif') !important;display  : block !important;position : absolute !important;top      : 0 !important;right    : 0 !important;height   : 13px !important;width    : 20px !important;}."+a.name+"_toggle_bar_open,."+a.name+"_toggle_bar_close{cursor: pointer !important;}."+a.name+"_toggle_bar_open ."+a.name+"_toggle_button{background-position: 0 0 !important;}."+a.name+"_toggle_bar_close ."+a.name+"_toggle_button{background-position: 0 -18px !important;}."+a.name+"_toggle_bar_open:hover ."+a.name+"_toggle_button{background-position: -20px 0 !important;}."+a.name+"_toggle_bar_close:hover ."+a.name+"_toggle_button{background-position: -20px -18px !important;}");var m=function(K){var B,G,A,J,C,L,D,E,H,F;C=this;E=function(){C.doIt()};var I=/WebKit|Gecko|Presto/i.test(h.navigator.userAgent);this.table=g.createElement("table");this.table.setAttribute("cellpadding","0");this.table.setAttribute("cellspacing","0");this.table.setAttribute("class","members bborder");this.table.setAttribute("style","width:90%;");K.appendChild(this.table);B=g.createElement("tbody");this.table.appendChild(B);G=g.createElement("tr");G.setAttribute("class","alt tit");B.appendChild(G);A=u.newCell();u.addTitle(A,z("t_odt")+":");G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");H=g.createElement("div");this.oldTitle=g.createElement("span");H.appendChild(this.oldTitle);A.appendChild(H);G.appendChild(A);F=G;G=g.createElement("tr");G.setAttribute("class","alt");B.appendChild(G);A=u.newCell();J=u.addAnchor(A,z("b_sel"));J.addEventListener("click",function(){C.oldList.select()},false);J=u.addAnchor(A,z("b_del"));J.addEventListener("click",function(){C.setOldList()},false);J=u.addAnchor(A,z("b_loa"));J.addEventListener("click",function(){C.load()},false);J=u.addAnchor(A,z("b_sav"));J.addEventListener("click",function(){C.save("old")},false);G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");this.oldList=u.addTextarea(A);u.addOnChange(this.oldList,E,false);G.appendChild(A);if(I){u.makeTogleable(G,H,F)}G=g.createElement("tr");G.setAttribute("class","tit");B.appendChild(G);A=u.newCell();u.addTitle(A,z("t_ndt")+":");G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");H=g.createElement("div");this.newTitle=g.createElement("span");H.appendChild(this.newTitle);A.appendChild(H);G.appendChild(A);F=G;G=g.createElement("tr");B.appendChild(G);A=u.newCell();J=u.addAnchor(A,z("b_sel"));J.addEventListener("click",function(){C.newList.select()},false);J=u.addAnchor(A,z("b_del"));J.addEventListener("click",function(){C.setNewList()},false);J=u.addAnchor(A,z("b_get"));J.addEventListener("click",function(){C.setNewListFromPage()},false);J=u.addAnchor(A,z("b_sav"));J.addEventListener("click",function(){C.save("new")},false);J.setAttribute("title",z("b_svt"));G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");this.newList=u.addTextarea(A);u.addOnChange(this.newList,E,false);G.appendChild(A);if(I){u.makeTogleable(G,H,F)}G=g.createElement("tr");G.setAttribute("class","alt tit");B.appendChild(G);A=u.newCell();u.addTitle(A,z("t_fmt")+":");G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");this.selectFormat=u.addSelect(A);for(L in t.formats){u.addOption(t.formats[L].name,L,this.selectFormat)}D=w.get("selectFormat");this.selectFormat.selectedIndex=(D==null)?0:parseInt(D);this.selectFormat.addEventListener("change",function(){w.set("selectFormat",C.selectFormat.selectedIndex+"");E()},false);G.appendChild(A);G=g.createElement("tr");G.setAttribute("class","tit");B.appendChild(G);A=u.newCell();u.addTitle(A,z("t_col")+":");G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");this.selectColors=u.addSelect(A);for(L in o.names){u.addOption(o.names[L],L,this.selectColors)}D=w.get("selectColors");this.selectColors.selectedIndex=(D==null)?0:parseInt(D);this.selectColors.addEventListener("change",function(){w.set("selectColors",C.selectColors.selectedIndex+"");E()},false);G.appendChild(A);G=g.createElement("tr");G.setAttribute("class","alt");B.appendChild(G);A=u.newCell();A.setAttribute("colspan","2");A.setAttribute("class","col2");H=g.createElement("div");u.addTitle(H,z("t_inc")+":");A.appendChild(H);G.appendChild(A);F=G;G=g.createElement("tr");G.setAttribute("class","alt");B.appendChild(G);G.appendChild(u.newCell());A=u.newCell();A.setAttribute("class","col2");this.doAlliance=u.addCheckbox(A,z("o_tas"),"doAlliance",true,E);this.doTop3Score=u.addCheckbox(A,z("o_tts"),"doTop3Score",true,E);this.doTop3Percent=u.addCheckbox(A,z("o_ttp"),"doTop3Percent",true,E);this.doScore=u.addCheckbox(A,z("o_trs"),"doScore",true,E);this.doPercent=u.addCheckbox(A,z("o_trp"),"doPercent",true,E);this.doSpecial=u.addCheckbox(A,z("o_tsc"),"doSpecial",true,E);this.doData=u.addCheckbox(A,z("o_ldt"),"doData",true,E);G.appendChild(A);if(I){u.makeTogleable(G,H,F)}G=g.createElement("tr");G.setAttribute("class","tit");B.appendChild(G);A=u.newCell();A.setAttribute("colspan","2");A.setAttribute("class","col2");H=g.createElement("div");u.addTitle(H,z("t_out")+":");A.appendChild(H);G.appendChild(A);F=G;G=g.createElement("tr");B.appendChild(G);A=u.newCell();J=u.addAnchor(A,z("b_sel"));J.addEventListener("click",function(){C.stats.select()},false);G.appendChild(A);A=u.newCell();A.setAttribute("class","col2");this.stats=u.addTextarea(A);this.stats.setAttribute("readonly","readonly");this.stats.addEventListener("click",function(){C.stats.select()},false);G.appendChild(A);if(I){u.makeTogleable(G,H,F).open()}G=g.createElement("tr");G.setAttribute("class","alt tit");B.appendChild(G);A=u.newCell();u.addTitle(A,z("t_stb")+":");G.appendChild(A);this.statusLine=(A=u.newCell());A.setAttribute("class","col2");this.statusText=u.addText(A,"");G.appendChild(A);G=g.createElement("tr");G.setAttribute("class","tit");B.appendChild(G);A=u.newCell();A.setAttribute("colspan","2");A.setAttribute("class","col2");H=g.createElement("div");u.addTitle(H,z("t_pre")+":");A.appendChild(H);G.appendChild(A);F=G;G=g.createElement("tr");B.appendChild(G);A=u.newCell();A.setAttribute("colspan","2");A.setAttribute("id",a.name+"_preview");G.appendChild(A);if(I){u.makeTogleable(G,H,F).open()}this.preview=A;this.previewRow=G;this.setPreview()};m.prototype={load:function(){this.setOldList(w.get("oldData"))},save:function(A){w.set("oldData",this[A+"List"].value)},setOldList:function(A){if(arguments.length>0){this.oldList.value=A}else{this.oldList.value=""}this.doIt()},setNewList:function(A){if(arguments.length>0){this.newList.value=A}else{this.newList.value=""}this.doIt()},setStats:function(A){if(arguments.length>0){this.stats.value=A}else{this.stats.value=""}},setPreview:function(A){if(arguments.length>0){this.preview.innerHTML=A}else{this.preview.innerHTML=""}},setNewListFromPage:function(){if(this.currentPageData){this.setNewList(this.currentPageData);return}var F=g.getElementById("OGameClock");var I={timestamp:n.timestamp,strDate:q.date(F.innerHTML.split("<")[0]),strTime:q.time(F.getElementsByTagName("span")[0].innerHTML),members:{}};var B=g.getElementById("member-list");var N=B.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(var K=0;K<N.length;K++){var J=N[K].getElementsByTagName("td");var G=J[0].innerHTML.trim();var H;var C=J[2].getElementsByTagName("select");if(C.length>0){H=C[0].options[C[0].selectedIndex].innerHTML}else{H=J[2].innerHTML}H=H.trim();var E=J[3].getElementsByTagName("span")[0];var L=E.getElementsByTagName("a")[0];E=E.getAttribute("title");E=parseInt(E.replace(/\D/gi,""));var A=L.getAttribute("href");A=parseInt(A.replace(/^.*searchRelId\=(\d+)(\D.*)?$/,"$1"));L=parseInt(L.innerHTML.replace(/\D/gi,""));var M=J[4].getElementsByTagName("a")[0].innerHTML;M=M.replace(/[^\d\:]/gi,"");var D=q.date(J[5].innerHTML);I.members[G]={i:A,r:H,s:E,p:L,c:M,d:D}}this.currentPageData=JSON.stringify(I);this.setNewList(this.currentPageData)},setErrorStatus:function(A){this.statusText.nodeValue="";this.statusLine.setAttribute("class","overmark");if(arguments.length>0){this.statusText.nodeValue=A}},setOkStatus:function(A){this.statusText.nodeValue="";this.statusLine.setAttribute("class","undermark");if(arguments.length>0){this.statusText.nodeValue=A}},setTitle:function(C,A,B){this[C+"Title"].setAttribute("class",(B)?"undermark":"overmark");this[C+"Title"].innerHTML=A},doIt:function(){s.doIt(this)}};var x=function(C){var E=this;this.section=g.createElement("div");this.section.setAttribute("class","section");var A=g.createElement("h3");var B=g.createElement("span");this.button=g.createElement("a");this.button.setAttribute("class","closed");this.button.setAttribute("href","javascript:void(0);");this.button.addEventListener("click",function(){E.toggle()},false);u.addText(B,a.name);this.button.appendChild(B);A.appendChild(this.button);this.section.appendChild(A);C.appendChild(this.section);this.sectioncontent=g.createElement("div");this.sectioncontent.setAttribute("class","sectioncontent");this.sectioncontent.setAttribute("id",a.name);this.sectioncontent.setAttribute("style","display:none;");this.content=g.createElement("div");this.content.setAttribute("class","contentz");var D=g.createElement("div");D.setAttribute("class","footer");this.sectioncontent.appendChild(this.content);this.sectioncontent.appendChild(D);C.appendChild(this.sectioncontent);this.form=null;this.canLoad=true;this.wTime=30;this.toggleTimer=null};var k=function(C){var A=0,B=0;if(C.offsetParent){do{A+=C.offsetLeft;B+=C.offsetTop}while(C=C.offsetParent)}return{l:A,t:B}};x.prototype={loadForm:function(){this.canLoad=false;try{var B=g.getElementById("allyMemberlist");B=B.getElementsByTagName("div")[0];if(!B){throw 0}}catch(A){this.wTime=Math.round(this.wTime*1.1);var C=this;setTimeout(function(){C.loadForm()},this.wTime);return}this.form=new m(this.content);this.form.setErrorStatus(z("e_nod"));this.form.setNewListFromPage();this.form.load();if(this.form.oldList.value==""){this.form.save("new");this.form.load()}},toggle:function(){if(this.canLoad){this.loadForm()}if(this.button.getAttribute("class")=="closed"){this.button.setAttribute("class","opened");this.sectioncontent.setAttribute("style","display:block;");var B=k(this.section);for(var A=10;A<=100;A+=30){setTimeout(function(){try{h.scroll(B.l,B.t)}catch(C){}},A)}}else{this.button.setAttribute("class","closed");this.sectioncontent.setAttribute("style","display:none;")}}};a.domWait=30;a.domLoader=function(){clearTimeout(this.domTimer);if(g.getElementById("allyInternText")){delete this.dom;this.dom=new x(g.getElementById("eins"))}else{this.domWait=Math.round(this.domWait*1.1);this.domTimer=setTimeout(function(){a.domLoader()},this.domWait)}};a.init=function(){this.domLoader();try{g.querySelector("a.navi.overview").addEventListener("click",function(){a.domWait=30;a.domLoader()},false);var A=g.querySelector("#form_assignRank a.save_bigger");if(A){A.addEventListener("click",function(){a.domWait=30;a.domTimer=setTimeout(function(){a.domLoader()},500)},false)}}catch(B){}};a.init()};var i=function(){if(arguments.callee.done){return}arguments.callee.done=true;if(b){clearInterval(b)}c()};if(g.addEventListener){g.addEventListener("DOMContentLoaded",i,false)}if(/WebKit/i.test(h.navigator.userAgent)){var b=setInterval(function(){if(/loaded|complete/.test(g.readyState)){i()}},10)}h.onload=i})();