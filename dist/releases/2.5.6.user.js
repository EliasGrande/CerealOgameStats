// ==UserScript==
// @name           CerealOgameStats
// @description    Make alliance stats from ogame to post in forums
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/134405.user.js
// @updateURL      https://userscripts.org/scripts/source/134405.meta.js
// @icon           http://s3.amazonaws.com/uso_ss/icon/134405/large.png
// @version        2.5.6
// @include        *://*.ogame.*/game/index.php?*page=alliance*
// ==/UserScript==
/*!

	CerealOgameStats

	Makes alliance stats from the ogame alliance memberdata and
	transforms it into a forum friendly code.

	Copyright (C) 2012 Elías Grande Cásedas

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see http://www.gnu.org/licenses/

*/
(function(){var d=window,i;try{if(unsafeWindow){d=unsafeWindow}}catch(g){}i=d.document;var f=function(m){var l=i.createElement("style");l.setAttribute("type","text/css");if(l.styleSheet){l.styleSheet.cssText=m}else{l.appendChild(i.createTextNode(m))}var e=i.getElementsByTagName("head")[0];e.appendChild(l)};f("#member-list {display:none;}");var a={ready:false,list:i.createElement("table"),wait:10};var j=function(){try{var l=i.getElementById("member-list");if(!l){throw 0}else{a.list.innerHTML=l.innerHTML;a.ready=true;delete a.wait;f("#member-list {display:table;}")}}catch(m){a.wait=Math.round(a.wait*1.1);var n=this;setTimeout(j,a.wait)}};j();var h={name:"CerealOgameStats",home:"http://userscripts.org/scripts/show/134405"};String.prototype.replaceAll=function(e,l){return this.split(e).join(l)};String.prototype.recursiveReplaceMap=function(o,n,l){if(l==0){return this.split(o[0]).join(n[0])}var m,e=this.split(o[l]);for(m in e){e[m]=e[m].recursiveReplaceMap(o,n,l-1)}return e.join(n[l])};String.prototype.replaceMap=function(e){var l,o,n,m;o=new Array();n=new Array();m=0;for(l in e){o.push(l);n.push(e[l]);m++}if(m==0){return this}else{return this.recursiveReplaceMap(o,n,m-1)}};String.prototype.trimNaN=function(){return this.replace(/^\D+$/,"").replace(/^\D*(\d)/,"$1").replace(/(\d)\D*$/,"$1")};var b=function(){var r=function(){this.getMeta("version","ogame-version",null);this.getMeta("language","ogame-language","en");this.getMeta("timestamp","ogame-timestamp",null);this.getMeta("universe","ogame-universe",null);this.getMeta("alliance_id","ogame-alliance-id",null);this.getMeta("player_name","ogame-player-name","")};r.prototype={getMeta:function(C,D,E){try{this[C]=i.querySelector('meta[name="'+D+'"]').getAttribute("content")}catch(F){this[C]=E}}};var p=new r();var y={id:function(C){return h.name+"_"+p.universe+"_"+p.alliance_id+"_"+C},set:function(F,C){var D=this.id(F);try{d.localStorage.setItem(D,C)}catch(E){d.localStorage[D]=C}return C},get:function(F){var C=this.id(F);try{return d.localStorage.getItem(C)}catch(D){var E=d.localStorage[C];return(E=="undefined")?null:E}}};var t=function(){this.lc={}};t.prototype={get:function(C){if(this.lc[C]){return this.lc[C]}return C},set:function(D){for(var C in D){this.lc[C]=D[C]}},number:function(H){var G,C,F,D;G=H+"";C=G.split(".");F=C[0];D=C.length>1?this.lc.s_dec+C[1]:"";var E=/(\d+)(\d{3})/;while(E.test(F)){F=F.replace(E,"$1"+this.lc.s_tho+"$2")}return F+D},date:function(C){return C.trimNaN().split(/\D+/).join(this.lc.s_dat)},time:function(C){return C.trimNaN().split(/\D+/).join(this.lc.s_tim)},period:function(I){var D,H,G,C,F=parseInt(I),E="",J=0;D=Math.floor(F/604800);F-=D*604800;H=Math.floor(F/86400);F-=H*86400;G=Math.floor(F/3600);F-=G*3600;C=Math.floor(F/60);F-=C*60;if(D>0){E+=this.number(D)+this.lc.a_wee+" ";J++}if(H>0){E+=this.number(H)+this.lc.a_day+" ";J++}if(G>0||J<1||C+F<1){E+=this.number(G)+this.lc.a_hou+" ";J++}if(C>0||J<2||(J==2&&F<1)){E+=this.number(C)+this.lc.a_min+" ";J++}if(F>0||J<3){E+=this.number(F)+this.lc.a_sec}return E.trim()}};var s=new t();var B=function(C){return s.get(C)};s.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"w",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Select",b_del:"Erase",b_get:"Get from this page",b_sav:'Save as "Old data"',b_loa:"Load saved data",b_res:"Reset stats",t_odt:"Old data",t_ndt:"New data",t_fmt:"Format",t_col:"Colors",t_inc:"Include",t_out:"Statistics (code)",t_stb:"Status",t_pre:"Evolution",t_exp:"Export to forums",p_ago:"{period} ago",p_now:"now",c_dbg:"Dark background",c_lbg:"Light background",e_nod:"No old data",e_nnd:"No new data",e_odf:"The old data has wrong format",e_ndf:"The new data has wrong format",e_unk:"Unexpected error",e_ndt:"No data",e_wft:"Wrong format",w_pcs:"Processing",o_tdt:"Evolution of the alliance since {oldDate} to {newDate}",o_tet:"Elapsed time",o_tas:"Alliance summary",o_ptl:"Total points",o_ppm:"Points per member",o_ttt:"Top 3 by total score",o_tts:"Top 3 by gained score",o_ttp:"Top 3 by gained percent",o_ttg:"Top 3 by gained positions",o_trt:"Total score rank",o_trs:"Gained score rank",o_trp:"Gained percent rank",o_trg:"Gained positions rank",o_tsc:"Special cases",o_cnm:"new member",o_cla:"leaves the alliance",o_bdg:"banned",o_bdq:"unbanned",o_ldt:"Latest data (for future statistics)",o_abt:"Statistics performed with {link}",e_oga:"OGame Error, reload this page may fix it"});if(/es|ar|mx/.test(p.language)){s.set({s_dec:",",s_tho:".",a_wee:"s",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Seleccionar",b_del:"Borrar",b_get:"Obtener de esta página",b_sav:'Guardar como "Datos antiguos"',b_loa:"Cargar datos guardados",b_res:"Resetear estadísticas",t_odt:"Datos antiguos",t_ndt:"Datos nuevos",t_fmt:"Formato",t_col:"Colores",t_inc:"Incluir",t_out:"Estadísticas (código)",t_stb:"Estado",t_pre:"Evolución",t_exp:"Exportar para foros",p_ago:"hace {period}",p_now:"ahora",c_dbg:"Fondo oscuro",c_lbg:"Fondo claro",e_nod:"No hay datos antiguos",e_nnd:"No hay datos nuevos",e_odf:"Los datos antiguos tienen un formato erróneo",e_ndf:"Los datos nuevos tienen un formato erróneo",e_unk:"Error inesperado",e_ndt:"Sin datos",e_wft:"Formato erróneo",w_pcs:"Procesando",o_tdt:"Evolución de la alianza desde el {oldDate} hasta el {newDate}",o_tet:"Tiempo transcurrido",o_tas:"Resumen de la alianza",o_ptl:"Puntos totales",o_ppm:"Puntos por miembro",o_ttt:"Top 3 por puntos totales",o_tts:"Top 3 por puntos subidos",o_ttp:"Top 3 por porcentaje subido",o_ttg:"Top 3 por posiciones subidas",o_trt:"Ranking por puntos totales",o_trs:"Ranking por puntos subidos",o_trp:"Ranking por porcentaje subido",o_trg:"Ranking por posiciones subidas",o_tsc:"Casos especiales",o_cnm:"nuevo miembro",o_cla:"abandona la alianza",o_bdg:"baneado",o_bdq:"desbaneado",o_ldt:"Datos más recientes (para futuras estadísticas)",o_abt:"Estadísticas realizadas con {link}",e_oga:"Error de OGame, recargar esta página puede arreglarlo"})}else{if(/fr/.test(p.language)){s.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"s",a_day:"j",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Sélectionner",b_del:"Effacer",b_get:"Recharger de cette page",b_sav:'Sauvegarder comme "Anciennes données"',b_loa:"Charger anciennes données",b_res:"Réinitialiser les statistiques",t_odt:"Anciennes données",t_ndt:"Nouvelles données",t_fmt:"Format",t_col:"Couleur",t_inc:"Inclure",t_out:"Statistiques (code)",t_stb:"Statut",t_pre:"Évolution",t_exp:"Exporter pour forums",p_ago:"{period} depuis le début",p_now:"maintenant",c_dbg:"Arrière plan foncé",c_lbg:"Arrière plan clair",e_nod:"Pas d'anciennes données",e_nnd:"Pas de nouvelles données",e_odf:"Les anciennes données ont un mauvais format",e_ndf:"Les nouvelles données ont un mauvais format",e_unk:"Erreur inattendu",e_ndt:"Pas de données",e_wft:"Mauvais format",w_pcs:"Traitement en cours",o_tdt:"Évolution de l'alliance du {oldDate} au {newDate}",o_tet:"Temps passé",o_tas:"Résumé de l'alliance ",o_ptl:"Points totaux",o_ppm:"Points par membres",o_ttt:"Top 3 par points totaux",o_tts:"Top 3 par points gagnées",o_ttp:"Top 3 par pourcentage gagné",o_ttg:"Top 3 par places gagnées",o_trt:"Rang par points totaux",o_trs:"Rang par points gagnées",o_trp:"Rang par pourcentage gagné",o_trg:"Rang par places gagnées",o_tsc:"Cas spéciaux",o_cnm:"Nouveaux Membres",o_cla:"A quitté l'alliance",o_bdg:"Banni",o_bdq:"Débanni",o_ldt:"Dernières données (pour statistiques futures)",o_abt:"Statistiques obtenues avec {link}",e_oga:"Erreur OGame, recharger la page peut régler le problème"})}else{if(/tr/.test(p.language)){s.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"h",a_day:"g",a_hou:"s",a_min:"d",a_sec:"s",b_sel:"Seç",b_del:"Sil",b_get:"Bu sayfadankini kullan",b_sav:'"Eski veri" olarak kaydet',b_loa:"Kaydedilen verileri yükle",b_res:"İstatistikleri sıfırla",t_odt:"Eski veri",t_ndt:"Yeni veri",t_fmt:"Biçim",t_col:"Renkler",t_inc:"Ekle",t_out:"İstatistik (code)",t_stb:"Durum",t_pre:"Gelişim",t_exp:"Forumlara Aktar ",p_ago:"{period} önce",p_now:"şimdi",c_dbg:"Koyu arka plan",c_lbg:"Açık arka plan",e_nod:"Eski veri",e_nnd:"Yeni veri yok",e_odf:"Eski veri hatalı formatta",e_ndf:"Yeni veri hatalı formatta",e_unk:"Beklenmeyen hata",e_ndt:"Veri yok",e_wft:"Yanlış format",w_pcs:"İşleniyor",o_tdt:"Gelişim Zaman Aralığı {oldDate} - {newDate} ",o_tet:"Geçen zaman",o_tas:"İttifak Bilgisi",o_ptl:"Toplam Puan",o_ppm:"Üye Başına Ortalama Puan",o_ttt:"Toplam Puana Göre En İyi 3",o_tts:"Puan Artışına Göre En İyi 3",o_ttp:"Yüzdelik Artışa Göre En İyi 3",o_ttg:"Sıra Artışına Göre En İyi 3",o_trt:"Toplam Puana Göre Sıralama",o_trs:"Puan Artışına Göre Sıralama",o_trp:"Yüzdelik Artışa Göre Sıralama",o_trg:"Sıra Artışına Göre Sıralama",o_tsc:"Özel Durumlar",o_cnm:"Yeni Üye",o_cla:"İttifaktan ayrılır",o_bdg:"Yasaklı",o_bdq:"Yasağı kaldırılmış",o_ldt:"Son Veri (Gelecekteki İstatistikler İçin)",o_abt:"{link} tarafından gerçekleştirilen istatistikler",e_oga:"OGame Hatası, Düzeltmek İçin Sayfayı Tekrar Yükleyin"})}else{if(/pt|br/.test(p.language)){s.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"s",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Seleccionar",b_del:"Apagar",b_get:"Obter desta página",b_sav:'Gravar como "Informação antiga"',b_loa:"Carregar informação gravada",b_res:"Recomeçar",t_odt:"Informação antiga",t_ndt:"Informação nova",t_fmt:"Formato",t_col:"Cores",t_inc:"Incluir",t_out:"Estatísticas (código)",t_stb:"Estado",t_pre:"Evolução",t_exp:"Exportar para foruns",p_ago:"{period} atrás",p_now:"agora",c_dbg:"Fundo escuro",c_lbg:"Fundo claro",e_nod:"Sem informação antiga",e_nnd:"Sem informação nova",e_odf:"A informação antiga tem formato errado",e_ndf:"A informação nova tem formato errado",e_unk:"Erro inesperado",e_ndt:"Sem informação",e_wft:"Formato errado",w_pcs:"Processar",o_tdt:"Evolução da aliança desde {oldDate} até {newDate}",o_tet:"Tempo decorrido",o_tas:"Sumario da aliança",o_ptl:"Pontos totais",o_ppm:"Pontos por membro",o_ttt:"Top 3 por pontos totais",o_tts:"Top 3 por pontos ganhos",o_ttp:"Top 3 por percentagem ganha",o_ttg:"Top 3 por posições ganhas",o_trt:"Classificação total de pontos",o_trs:"Classificação pontos ganhos",o_trp:"Classificação percentagem ganha",o_trg:"Classificação posições ganhos",o_tsc:"Casos especiais",o_cnm:"novo membro",o_cla:"deixou aliança",o_bdg:"banido",o_bdq:"ex-banido",o_ldt:"Ultima data (para futura estatística)",o_abt:"Estatísticas realizadas por {link}"})}}}}var A=function(){this.names=new Array();this.colors=new Array();this.selected=null};A.prototype={add:function(D,C){this.names.push(D);this.colors.push(C)},select:function(C){this.selected=this.colors[C]},replace:function(C){return C.replaceMap(this.selected)}};var q=new A();q.add(B("c_dbg"),{"{nameColor}":"white","{growsColor}":"#00FF40","{decreasesColor}":"#ED7010","{remainsColor}":"#00DDDD"});q.add(B("c_lbg"),{"{nameColor}":"purple","{growsColor}":"green","{decreasesColor}":"red","{remainsColor}":"blue"});var n={diffScore:function(C,F){var E=F-C;var D=((F/C)-1)*100;return{score:E,percent:D}}};var l=function(){this.formats=new Array();this.selected=null;this.escapeMap={"[":"[[u][/u]","]":"[u][/u]]"};this.lastReplace={"{grows}":"\u00BB","{decreases}":"\u00AB","{remains}":"\u007E","{remainsNo}":"\u00D8","{up}":"\u2191","{down}":"\u2193","{rank}":"#","{\\":"{","\\}":"}"};this.layout={sectionStart:"[size=big]{title}[/size]",sectionEnd:"\n\n",dateTime:"{date} ([i]{time}[/i])",header:"[b]{title}[/b]\n{elapsedTitle}: {elapsedTime}\n\n",allianceLine:"\n[color={diffColor}]{diff}[/color] [b][color={nameColor}]{title}[/color][/b] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",top3TScoreLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ({newScore})",top3ScoreLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffScore}[/color][/b])",top3PercentLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",top3PositionsLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffPos}[/color][/b])",rankLine:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",rank:" [size=small]{rank}[/size]{newPos} ([b][color={diffColor}]{diffPos}[/color][/b])",rankNoDiff:" [size=small]{rank}[/size]{newPos} ([b][color={remainsColor}]{remainsNo}[/color][/b])",rankLineNoDiff:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {oldScore} ([b][color={remainsColor}]{remainsNo}[/color][/b])",from0Member:"\n[color={growsColor}]{grows} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={growsColor}]{score}[/color][/b] [size=small]({reason})[/size]",to0Member:"\n[color={decreasesColor}]{decreases} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={decreasesColor}]{score}[/color][/b] [size=small]({reason})[/size]",scriptData:"\n[i]{scriptDataTitle}:[/i]\n[spoiler][code]{scriptData}[/code][/spoiler]",scriptLink:"\n[i]"+B("o_abt").replace("{link}","[url={scriptHome}]{scriptName}[/url]")+"[/i]"}};l.prototype={add:function(C,D){this.formats.push({name:C,patterns:D,escapeMap:(arguments.length>2)?arguments[2]:false})},select:function(C){this.selected=this.formats[C]},escape:function(C){if(this.selected.escapeMap){return C.replaceMap(this.selected.escapeMap)}else{return C.replaceMap(this.escapeMap)}},diff:function(D,E){var C=D;if(E<0){C=C.replaceMap({"{diffColor}":"{decreasesColor}","{diff}":"{decreases}"})}else{if(E>0){C=C.replaceMap({"{diffColor}":"{growsColor}","{diff}":"{grows}"})}else{C=C.replaceMap({"{diffColor}":"{remainsColor}","{diff}":"{remains}"})}}return C},header:function(C){return this.layout.header.replaceMap({"{title}":B("o_tdt").replaceMap({"{oldDate}":this.layout.dateTime.replaceMap({"{date}":C.oldDate,"{time}":C.oldTime}),"{newDate}":this.layout.dateTime.replaceMap({"{date}":C.newDate,"{time}":C.newTime})}),"{elapsedTitle}":B("o_tet"),"{elapsedTime}":this.escape(s.period(C.newTimestamp-C.oldTimestamp))})},alliance:function(C){if(C.oldScore==0){return""}return this.layout.sectionStart.replaceAll("{title}",B("o_tas"))+this.diff(this.layout.allianceLine,C.diffScore).replaceMap({"{title}":B("o_ptl"),"{newScore}":C.formatted.newScore,"{diffScore}":C.formatted.diffScore,"{diffPercent}":C.formatted.diffPercent})+this.diff(this.layout.allianceLine,C.diffMemberScore).replaceMap({"{title}":B("o_ppm"),"{newScore}":C.formatted.newMemberScore,"{diffScore}":C.formatted.diffMemberScore,"{diffPercent}":C.formatted.diffMemberPercent})+this.layout.sectionEnd},position:function(H,C){var D=H+"",G=(D).length,F=(C+"").length;for(var E=G;E<F;E++){D="0"+D}return D},top3:function(F,H,J,C){var E=(this.layout.sectionStart+"").replace("{title}",J);var D=Math.min(F.length,3);var G,I;for(G=0;G<D;G++){I=F[G];E=E+this.diff(C,I.diffScore).replaceMap({"{position}":this.position(G+1,D),"{name}":this.escape(I.name),"{diffPos}":I.formatted.diffPos.replaceMap({"+":"{up}","-":"{down}"})}).replaceAll("{"+H+"}",I.formatted[H])}return E+this.layout.sectionEnd},rank:function(E,I){var D=(this.layout.sectionStart+"").replace("{title}",I);var C=E.length;var F,H;for(F=0;F<C;F++){H=E[F];var G=(H.diffScore==0)?this.layout.rankLineNoDiff:this.layout.rankLine;D=D+this.diff(G,H.diffScore).replaceMap({"{position}":this.position(F+1,C),"{name}":this.escape(H.name),"{oldScore}":H.formatted.oldScore,"{newScore}":H.formatted.newScore,"{diffScore}":H.formatted.diffScore,"{diffPercent}":H.formatted.diffPercent});G=(H.diffPos==0)?this.layout.rankNoDiff:this.layout.rank;D=D+this.diff(G,H.diffPos).replaceMap({"{newPos}":H.formatted.newPos,"{diffPos}":H.formatted.diffPos.replaceMap({"+":"{up}","-":"{down}"})})}return D+this.layout.sectionEnd},specialCases:function(E,F){if((E.length+F.length)==0){return""}var C=this.layout.sectionStart.replace("{title}",B("o_tsc"));var D,G;for(D in F){G=F[D];C=C+this.layout.from0Member.replaceMap({"{name}":this.escape(G.name),"{score}":G.score,"{reason}":G.reason})}for(D in E){G=E[D];C=C+this.layout.to0Member.replaceMap({"{name}":this.escape(G.name),"{score}":G.score,"{reason}":G.reason})}return C+this.layout.sectionEnd},format:function(E,H,M,I,L,J){var G=this.header(H);if(E.alliance){G=G+this.alliance(H)}var K="";var F="";var N="";var Q="";var D="";var C="";var O="";var P="";if(M.length>0){M=M.sort(function(S,R){if(S.newScore==R.newScore){return(S.diffScore>=R.diffScore)?-1:1}else{return(S.newScore>=R.newScore)?-1:1}});if(E.top3TScore&&(M.length>5||!E.tScore)){F=this.top3(M,"newScore",B("o_ttt"),this.layout.top3TScoreLine)}if(E.tScore){D=this.rank(M,B("o_trt"))}M=M.sort(function(S,R){if(S.diffScore==R.diffScore){if(S.diffPercent==R.diffPercent){return(S.newScore>=R.newScore)?-1:1}else{return(S.diffPercent>=R.diffPercent)?-1:1}}else{return(S.diffScore>=R.diffScore)?-1:1}});if(E.top3Score&&(M.length>5||!E.score)){K=this.top3(M,"diffScore",B("o_tts"),this.layout.top3ScoreLine)}if(E.score){C=this.rank(M,B("o_trs"))}M=M.sort(function(S,R){if(S.diffPercent==R.diffPercent){if(S.diffScore==R.diffScore){return(S.newScore>=R.newScore)?-1:1}else{return(S.diffScore>=R.diffScore)?-1:1}}else{return(S.diffPercent>=R.diffPercent)?-1:1}});if(E.top3Percent&&(M.length>5||!E.percent)){N=this.top3(M,"diffPercent",B("o_ttp"),this.layout.top3PercentLine)}if(E.percent){O=this.rank(M,B("o_trp"))}M=M.sort(function(S,R){if(S.diffPos==R.diffPos){if(S.diffScore==R.diffScore){if(S.diffPercent==R.diffPercent){return(S.newScore>=R.newScore)?-1:1}else{return(S.diffPercent>=R.diffPercent)?-1:1}}else{return(S.diffScore>=R.diffScore)?-1:1}}else{return(S.diffPos>=R.diffPos)?-1:1}});if(E.top3Positions&&(M.length>5||!E.positions)){Q=this.top3(M,"diffPos",B("o_ttg"),this.layout.top3PositionsLine)}if(E.positions){P=this.rank(M,B("o_trg"))}}G=G+F+K+N+Q+D+C+O+P;if(E.special){G=G+this.specialCases(I,L)}if(E.data){G=G+this.layout.scriptData.replace("{scriptDataTitle}",B("o_ldt"))}G=G+this.layout.scriptLink;G=G.replaceMap(this.selected.patterns).replaceMap(q.selected).replaceMap({"{scriptName}":h.name,"{scriptHome}":h.home}).replaceMap(this.lastReplace).replace("{scriptData}",J.replaceMap({"<":"\\u003C",">":"\\u003E","[":"\\u005B","]":"\\u005D"}));return G.trim()}};var v=new l();v.add("phpBB",{"[size=big]":"[size=20]","[size=small]":"[size=10]"});v.add("phpBB3",{"[size=big]":"[size=140]","[size=small]":"[size=80]"});v.add("SMF",{"[size=big]":"[size=14pt]","[size=small]":"[size=7pt]"});v.add("vBulletin",{"[size=big]":"[size=4]","[size=small]":"[size=1]"});v.add("HTML",{"{grows}":"&raquo;","{decreases}":"&laquo;","{remains}":"&sim;","{remainsNo}":"&Oslash;","{up}":"&uarr;","{down}":"&darr;","[size=big]":'<span style="font-size: 140%;">',"[size=small]":'<span style="font-size: 80%;">',"[/size]":"</span>","[color={":'<span style="color: {',"Color}]":'Color}">',"[/color]":"</span>","[b]":"<b>","[/b]":"</b>","[i]":"<i>","[/i]":"</i>","\n":"<br />\n","[spoiler]":"<div>","[/spoiler]":"</div>","[code]":'<textarea onclick="this.select();" rows="5" cols="20">',"[/code]":"</textarea>","[url={scriptHome}]{scriptName}[/url]":'<a href="{scriptHome}">{scriptName}</a>'},{"&":"&amp;","<":"&lt;",">":"&gt;"});var x=function(){};x.prototype={reset:function(){this.allyInfo={oldCount:0,oldScore:0,newCount:0,newScore:0};this.membersInfo=new Array();this.oldMembersInfo=new Array();this.newMembersInfo=new Array();this.to0MembersInfo=new Array();this.from0MembersInfo=new Array()},readData:function(F,E){var C,D=JSON.parse(F);this.allyInfo[E+"Timestamp"]=D.timestamp;this.allyInfo[E+"Date"]=D.strDate;this.allyInfo[E+"Time"]=D.strTime;for(C in D.members){this[E+"MembersInfo"].push({id:("i" in D.members[C])?D.members[C].i:-1,name:C,score:D.members[C].s,pos:D.members[C].p,coord:D.members[C].c,date:D.members[C].d,noPartner:true});this.allyInfo[E+"Count"]++;this.allyInfo[E+"Score"]=this.allyInfo[E+"Score"]+D.members[C].s}return D},merge:function(){var H,F,K,E,G,C,I;K=this.allyInfo.oldCount;for(H in this.newMembersInfo){G=this.newMembersInfo[H];for(F=0;F<K;F++){E=this.oldMembersInfo[F];if((E.noPartner)&&(((E.id>=0)&&(E.id==G.id))||(E.name==G.name)||(E.coord==G.coord))){break}}if(F!=K){this.oldMembersInfo[F].noPartner=false;this.newMembersInfo[H].noPartner=false;if((G.score==0)||(G.pos==0)){this.to0MembersInfo.push({name:G.name,score:s.number(E.score),reason:B("o_bdg")})}else{if((E.score==0)||(E.pos==0)){this.from0MembersInfo.push({name:G.name,score:s.number(G.score),reason:B("o_bdq")})}else{I=n.diffScore(E.score,G.score);C={name:G.name,oldScore:E.score,newScore:G.score,oldPos:E.pos,newPos:G.pos,diffPos:E.pos-G.pos,diffScore:I.score,diffPercent:I.percent};C.formatted={oldScore:s.number(C.oldScore),newScore:s.number(C.newScore),oldPos:s.number(C.oldPos.toFixed()),newPos:s.number(C.newPos.toFixed()),diffPos:((C.diffPos<0)?"":"+")+s.number(C.diffPos.toFixed()),diffScore:((C.diffScore<0)?"":"+")+s.number(C.diffScore.toFixed()),diffPercent:((C.diffPercent<0)?"":"+")+s.number(C.diffPercent.toFixed(2))};this.membersInfo.push(C)}}}}var D,J;for(J in this.newMembersInfo){D=this.newMembersInfo[J];if(D.noPartner){this.from0MembersInfo.push({name:D.name,score:s.number(D.score),reason:B("o_cnm")})}}for(J in this.oldMembersInfo){D=this.oldMembersInfo[J];if(D.noPartner){this.to0MembersInfo.push({name:D.name,score:s.number(D.score),reason:B("o_cla")})}}this.to0MembersInfo.sort(function(M,L){return parseInt(M.score)-parseInt(L.score)});this.from0MembersInfo.sort(function(M,L){return parseInt(L.score)-parseInt(M.score)});delete this.oldMembersInfo;delete this.newMembersInfo;I=n.diffScore(this.allyInfo.oldScore,this.allyInfo.newScore);this.allyInfo.diffScore=I.score;this.allyInfo.diffPercent=I.percent;this.allyInfo.oldMemberScore=this.allyInfo.oldScore/this.allyInfo.oldCount;this.allyInfo.newMemberScore=this.allyInfo.newScore/this.allyInfo.newCount;I=n.diffScore(this.allyInfo.oldMemberScore,this.allyInfo.newMemberScore);this.allyInfo.diffMemberScore=I.score;this.allyInfo.diffMemberPercent=I.percent;this.allyInfo.formatted={oldScore:s.number(this.allyInfo.oldScore),newScore:s.number(this.allyInfo.newScore),diffScore:((this.allyInfo.diffScore<0)?"":"+")+s.number(this.allyInfo.diffScore.toFixed()),diffPercent:((this.allyInfo.diffPercent<0)?"":"+")+s.number(this.allyInfo.diffPercent.toFixed(2)),oldMemberScore:s.number(this.allyInfo.oldMemberScore.toFixed()),newMemberScore:s.number(this.allyInfo.newMemberScore.toFixed()),diffMemberScore:((this.allyInfo.diffMemberScore<0)?"":"+")+s.number(this.allyInfo.diffMemberScore.toFixed()),diffMemberPercent:((this.allyInfo.diffMemberPercent<0)?"":"+")+s.number(this.allyInfo.diffMemberPercent.toFixed(2))}},doIt:function(G){G.setStats();G.setPreview();v.select(parseInt(G.selectFormat.selectedIndex));q.select(parseInt(G.selectColors.selectedIndex));G.setOkStatus(B("w_pcs")+"...");this.reset();var H,J,F=false;if(G.oldList.value.trim()==""){G.setErrorStatus(B("e_nod"));G.setTitle("old",B("e_ndt"),false);F=true}if(!F){try{H=this.readData(G.oldList.value,"old");J=H.strDate+" (<i>"+H.strTime+"</i>) &rarr; "+((p.timestamp==H.timestamp)?B("p_now"):B("p_ago").replace("{period}",s.period(p.timestamp-H.timestamp)));if(this.oldMembersInfo.length==0||/NaN|undefined/.test(J)){throw 0}G.setTitle("old",J,true)}catch(I){G.setTitle("old",B("e_wft"),false);G.setErrorStatus(B("e_odf"));F=true}}if(G.newList.value.trim()==""){G.setErrorStatus(B("e_nnd"));G.setTitle("new",B("e_ndt"),false);return}try{H=this.readData(G.newList.value,"new");J=H.strDate+" (<i>"+H.strTime+"</i>) &rarr; "+((p.timestamp==H.timestamp)?B("p_now"):B("p_ago").replace("{period}",s.period(p.timestamp-H.timestamp)));if(this.newMembersInfo.length==0||/NaN|undefined/.test(J)){throw 0}G.setTitle("new",J,true);if(F){return}}catch(I){G.setErrorStatus(B("e_ndf"));return}try{this.merge();var C={alliance:G.doAlliance.checked,top3TScore:G.doTop3TScore.checked,top3Score:G.doTop3Score.checked,top3Percent:G.doTop3Percent.checked,top3Positions:G.doTop3Positions.checked,tScore:G.doTScore.checked,score:G.doScore.checked,percent:G.doPercent.checked,positions:G.doPositions.checked,special:G.doSpecial.checked,data:G.doData.checked};G.setStats(v.format(C,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,G.newList.value.trim()));C.data=false;v.select(v.formats.length-1);q.select(0);var E="[color={nameColor}][b]{name}[/b][/color]".replaceMap(v.selected.patterns).replaceAll("{name}",p.player_name);var D=E.replaceAll("{nameColor}","#FF0");E=E.replaceMap(q.selected);G.setPreview(v.format(C,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,G.newList.value.trim()).replaceAll(v.selected.patterns["[size=small]"],"<span>").replaceAll(v.selected.patterns["[size=big]"],'<span style="font-size:20px">').replaceAll(E,D));G.hideStatus()}catch(I){G.setErrorStatus(B("e_unk")+": "+I)}}};var u=new x();var e=function(){};e.prototype={addTextarea:function(D){var C=i.createElement("textarea");C.setAttribute("cols","120");C.setAttribute("rows","40");C.setAttribute("class","textBox");D.appendChild(C);return C},addSelect:function(D){var C=i.createElement("select");C.setAttribute("class","dropdown");D.appendChild(C);return C},addOption:function(F,E,D){var C=i.createElement("option");C.appendChild(i.createTextNode(F));C.setAttribute("value",E);D.appendChild(C);return C},addAnchor:function(D,E){var C=i.createElement("a");C.setAttribute("href","javascript:void(0);");C.setAttribute("class",h.name);C.appendChild(i.createTextNode(E));D.appendChild(C);return C},addTitle:function(D,E){var C=i.createElement("b");C.appendChild(i.createTextNode(E));C.setAttribute("style","display:block;font-size:12px");D.appendChild(C);return C},newCell:function(){var C=i.createElement("td");return C},addText:function(D,E){var C=i.createTextNode(E);D.appendChild(C);return C},addBr:function(C){C.appendChild(i.createElement("br"))},addEvent:function(E,D,C){E.addEventListener(D,C,false)},addOnChange:function(D,C){D.addEventListener("change",C,false);D.addEventListener("keyup",C,false)},cancelBubble:function(D){var C=D?D:d.event;if(C.stopPropagation){C.stopPropagation()}if(C.cancelBubble!=null){C.cancelBubble=true}},addCheckbox:function(E,I,J,H,G){var C=i.createElement("input");C.setAttribute("type","checkbox");C.setAttribute("id",h.name+"_"+J);C.setAttribute("style","cursor:pointer;");E.appendChild(C);var D=i.createElement("label");D.setAttribute("for",h.name+"_"+J);D.setAttribute("style","cursor:pointer;");D.innerHTML="&nbsp;"+I;E.appendChild(D);this.addBr(E);var F=y.get(J);C.checked=(F==null)?H:(parseInt(F)==1);y.set(J,(C.checked)?1:0);C.addEventListener("change",function(){y.set(J,(C.checked)?1:0);G()},false);D.addEventListener("mouseover",function(){D.setAttribute("class","undermark")},false);D.addEventListener("mouseout",function(){D.removeAttribute("class")},false);return C},makeTogleable:function(J,N,K,F){var L=i.createElement("a");L.setAttribute("class",h.name+"_toggle_button");var G=F;if(G){var D=h.name+(new Date()).getTime();L.setAttribute("href","#"+D);L.setAttribute("id",D);L.addEventListener("click",w.cancelBubble,false)}else{L.setAttribute("href","javascript:void(0);")}var E=(J.length)?J:new Array(J);var C=true;var I=function(){C=true;for(var O in E){E[O].removeAttribute("style")}K.setAttribute("class",K.getAttribute("class").replace("_toggle_bar_open","_toggle_bar_close"))};var M=function(){C=false;for(var O in E){E[O].setAttribute("style","display:none;")}K.setAttribute("class",K.getAttribute("class").replace("_toggle_bar_close","_toggle_bar_open"))};var H=function(){if(C){M()}else{I()}if(G){L.click()}};K.setAttribute("class",K.hasAttribute("class")?K.getAttribute("class")+" "+h.name+"_toggle_bar_close":h.name+"_toggle_bar_close");K.addEventListener("click",H,false);H();N.setAttribute("style","position:relative;");N.appendChild(L);return{open:I,close:M,toggle:H}},addCss:f};var w=new e();w.addCss("#"+h.name+" table{width: 610px !important;}#"+h.name+" textarea{width: 350px !important;height: 70px !important;margin: 0 !important;padding: 5px !important;}#"+h.name+" a."+h.name+"{display: block !important;padding: 5px 0 0 0 !important;}#"+h.name+" select{width: 250px !important;}#"+h.name+" td{border-top: 2px dotted #242E38 !important;padding: 5px !important;text-align: left !important;}tr.alt #"+h.name+" td{border-top: 2px dotted #24292E !important;}#"+h.name+" td.col2{width: 364px !important;}#"+h.name+" tr.tit td{border-top: none !important;line-height: 18px !important;}td#"+h.name+"_preview{border-top: 2px dotted #242E38 !important;color: #6F9FC8 !important;}#"+h.name+"_preview div{padding-top: 5px !important;padding-bottom: 5px !important;}#"+h.name+"_preview a{display: inline !important;padding: 0 !important;}."+h.name+"_toggle_button{background-color: transparent !important;background-image: url('http://gf2.geo.gfsrv.net/cdn71/fc7a8ede3499a0b19ea17613ff0cb1.gif') !important;display  : block !important;position : absolute !important;top      : 0 !important;right    : 0 !important;height   : 18px !important;width    : 20px !important;}."+h.name+"_toggle_bar_open,."+h.name+"_toggle_bar_close{cursor: pointer !important;}."+h.name+"_toggle_bar_open ."+h.name+"_toggle_button{background-position: 0 0 !important;}."+h.name+"_toggle_bar_close ."+h.name+"_toggle_button{background-position: 0 -18px !important;}."+h.name+"_toggle_bar_open:hover ."+h.name+"_toggle_button{background-position: -20px 0 !important;}."+h.name+"_toggle_bar_close:hover ."+h.name+"_toggle_button{background-position: -20px -18px !important;}");var o=function(O){var F,K,D,N,G,P,H,I,E,L,J,C;G=this;I=function(){G.doIt()};var M=/WebKit|Gecko|Presto/i.test(d.navigator.userAgent);this.table=i.createElement("table");this.table.setAttribute("cellpadding","0");this.table.setAttribute("cellspacing","0");this.table.setAttribute("class","members bborder");O.appendChild(this.table);F=i.createElement("tbody");this.table.appendChild(F);K=i.createElement("tr");K.setAttribute("class","tit alt");F.appendChild(K);D=w.newCell();D.setAttribute("colspan","2");D.setAttribute("class","col2");L=i.createElement("div");w.addTitle(L,B("t_inc")+":");D.appendChild(L);K.appendChild(D);J=K;K=i.createElement("tr");K.setAttribute("class","alt");F.appendChild(K);K.appendChild(w.newCell());D=w.newCell();D.setAttribute("class","col2");this.doAlliance=w.addCheckbox(D,B("o_tas"),"doAlliance",true,I);this.doTop3TScore=w.addCheckbox(D,B("o_ttt"),"doTop3TScore",false,I);this.doTop3Score=w.addCheckbox(D,B("o_tts"),"doTop3Score",false,I);this.doTop3Percent=w.addCheckbox(D,B("o_ttp"),"doTop3Percent",false,I);this.doTop3Positions=w.addCheckbox(D,B("o_ttg"),"doTop3Positions",false,I);this.doTScore=w.addCheckbox(D,B("o_trt"),"doTScore",false,I);this.doScore=w.addCheckbox(D,B("o_trs"),"doScore",true,I);this.doPercent=w.addCheckbox(D,B("o_trp"),"doPercent",true,I);this.doPositions=w.addCheckbox(D,B("o_trg"),"doPositions",false,I);this.doSpecial=w.addCheckbox(D,B("o_tsc"),"doSpecial",true,I);this.doData=w.addCheckbox(D,B("o_ldt"),"doData",true,I);K.appendChild(D);if(M){w.makeTogleable(K,L,J,false)}K=i.createElement("tr");K.setAttribute("class","tit");F.appendChild(K);D=w.newCell();D.setAttribute("colspan","2");D.setAttribute("class","col2");L=i.createElement("div");w.addTitle(L,B("t_pre")+":");D.appendChild(L);K.appendChild(D);J=K;K=i.createElement("tr");F.appendChild(K);D=w.newCell();D.setAttribute("colspan","2");D.setAttribute("id",h.name+"_preview");K.appendChild(D);if(M){w.makeTogleable(K,L,J,false).open()}D.appendChild(this.preview=i.createElement("div"));this.previewRow=K;this.setPreview();K=i.createElement("tr");K.setAttribute("class","alt tit");F.appendChild(K);D=w.newCell();w.addTitle(D,B("t_odt")+":");K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");L=i.createElement("div");this.oldTitle=i.createElement("span");L.appendChild(this.oldTitle);D.appendChild(L);K.appendChild(D);J=K;K=i.createElement("tr");K.setAttribute("class","alt");F.appendChild(K);D=w.newCell();N=w.addAnchor(D,B("b_sel"));N.addEventListener("click",function(){G.oldList.select()},false);N=w.addAnchor(D,B("b_del"));N.addEventListener("click",function(){G.setOldList()},false);N=w.addAnchor(D,B("b_loa"));N.addEventListener("click",function(){G.load()},false);N=w.addAnchor(D,B("b_sav"));N.addEventListener("click",function(){G.save("old")},false);K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");this.oldList=w.addTextarea(D);w.addOnChange(this.oldList,I,false);K.appendChild(D);if(M){w.makeTogleable(K,L,J,true)}K=i.createElement("tr");K.setAttribute("class","tit");F.appendChild(K);D=w.newCell();w.addTitle(D,B("t_ndt")+":");K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");L=i.createElement("div");this.newTitle=i.createElement("span");L.appendChild(this.newTitle);D.appendChild(L);K.appendChild(D);J=K;K=i.createElement("tr");F.appendChild(K);D=w.newCell();N=w.addAnchor(D,B("b_sel"));N.addEventListener("click",function(){G.newList.select()},false);N=w.addAnchor(D,B("b_del"));N.addEventListener("click",function(){G.setNewList()},false);N=w.addAnchor(D,B("b_get"));N.addEventListener("click",function(){G.setNewListFromPage()},false);N=w.addAnchor(D,B("b_sav"));N.addEventListener("click",function(){G.save("new")},false);N.setAttribute("title",B("b_svt"));K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");this.newList=w.addTextarea(D);w.addOnChange(this.newList,I,false);K.appendChild(D);if(M){w.makeTogleable(K,L,J,true)}K=i.createElement("tr");K.setAttribute("class","tit alt");F.appendChild(K);D=w.newCell();D.setAttribute("colspan","2");D.setAttribute("class","col2");L=i.createElement("div");w.addTitle(L,B("t_exp")+":");D.appendChild(L);K.appendChild(D);J=K;E=new Array();K=i.createElement("tr");K.setAttribute("class","alt");F.appendChild(K);D=w.newCell();w.addText(D,B("t_fmt")+":");K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");this.selectFormat=w.addSelect(D);for(P in v.formats){w.addOption(v.formats[P].name,P,this.selectFormat)}H=y.get("selectFormat");this.selectFormat.selectedIndex=(H==null)?0:parseInt(H);this.selectFormat.addEventListener("change",function(){y.set("selectFormat",G.selectFormat.selectedIndex+"");I()},false);K.appendChild(D);E.push(K);K=i.createElement("tr");K.setAttribute("class","alt");F.appendChild(K);D=w.newCell();w.addText(D,B("t_col")+":");K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");this.selectColors=w.addSelect(D);for(P in q.names){w.addOption(q.names[P],P,this.selectColors)}H=y.get("selectColors");this.selectColors.selectedIndex=(H==null)?0:parseInt(H);this.selectColors.addEventListener("change",function(){y.set("selectColors",G.selectColors.selectedIndex+"");I()},false);K.appendChild(D);E.push(K);K=i.createElement("tr");K.setAttribute("class","alt");F.appendChild(K);D=w.newCell();w.addText(D,B("t_out")+":");N=w.addAnchor(D,B("b_sel"));N.addEventListener("click",function(){G.stats.select()},false);K.appendChild(D);D=w.newCell();D.setAttribute("class","col2");this.stats=w.addTextarea(D);this.stats.setAttribute("readonly","readonly");this.stats.addEventListener("click",function(){G.stats.select()},false);K.appendChild(D);E.push(K);if(M){w.makeTogleable(E,L,J,true)}K=i.createElement("tr");K.setAttribute("class","tit");F.appendChild(K);D=w.newCell();D.setAttribute("class","col2");D.setAttribute("align","right");D.setAttribute("colspan","2");K.appendChild(D);N=w.addAnchor(D,B("b_res"));N.setAttribute("class","action btn_blue float_right");N.addEventListener("click",function(){G.resetData()},false);this.statusRow=(K=i.createElement("tr"));K.setAttribute("class","alt tit");F.appendChild(K);D=w.newCell();w.addTitle(D,B("t_stb")+":");K.appendChild(D);this.statusLine=(D=w.newCell());D.setAttribute("class","col2");this.statusText=w.addText(D,"");K.appendChild(D);this.hideStatus()};o.prototype={load:function(){this.setOldList(y.get("oldData"))},save:function(C){y.set("oldData",this[C+"List"].value)},setOldList:function(C){if(arguments.length>0){this.oldList.value=C}else{this.oldList.value=""}this.doIt()},setNewList:function(C){if(arguments.length>0){this.newList.value=C}else{this.newList.value=""}this.doIt()},resetData:function(){this.setNewListFromPage();this.setOldList(this.currentPageData);y.set("oldData",this.currentPageData)},setStats:function(C){if(arguments.length>0){this.stats.value=C}else{this.stats.value=""}},setPreview:function(C){if(arguments.length>0){this.preview.innerHTML=C}else{this.preview.innerHTML=""}},setNewListFromPage:function(){if(this.currentPageData){this.setNewList(this.currentPageData);return}var H=i.getElementById("OGameClock");if(H==null){H=i.querySelector("li.OGameClock")}var K={timestamp:p.timestamp,strDate:s.date(H.innerHTML.split("<")[0]),strTime:s.time(H.getElementsByTagName("span")[0].innerHTML),members:{}};var P=a.list.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(var M=0;M<P.length;M++){var L=P[M].getElementsByTagName("td");var I=L[0].innerHTML.trim();var J;var D=L[2].getElementsByTagName("select");if(D.length>0){J=D[0].options[D[0].selectedIndex].innerHTML}else{J=L[2].innerHTML}J=J.trim();var G=L[3].getElementsByTagName("span");if(G.length>0){G=G[0]}else{G=L[3]}var N=G.getElementsByTagName("a")[0];G=G.getAttribute("title");G=parseInt(G.replace(/\D/gi,""));var C=N.getAttribute("href");C=parseInt(C.replace(/^.*searchRelId\=(\d+)(\D.*)?$/,"$1"));N=parseInt(N.innerHTML.replace(/\D/gi,""));var O=L[4].getElementsByTagName("a")[0].innerHTML;O=O.replace(/[^\d\:]/gi,"");var F=s.date(L[5].innerHTML);K.members[I]={i:C,r:J,s:G,p:N,c:O,d:F};var E=K.members[I];if(/NaN|undefined|null/.test(E.i+"")||(E.r)==null||typeof E.r=="undefined"||/NaN|undefined|null/.test(E.s+"")||/NaN|undefined|null/.test(E.p+"")||(!(/^\d+\:\d+\:\d+$/.test(E.c+"")))||(E.d)==null||typeof E.r=="undefined"){return false}}this.currentPageData=JSON.stringify(K);this.setNewList(this.currentPageData);return true},hideStatus:function(){this.statusRow.setAttribute("style","display:none")},showStatus:function(){this.statusRow.setAttribute("style","")},setErrorStatus:function(C){this.statusText.nodeValue="";this.statusLine.setAttribute("class","overmark");if(arguments.length>0){this.statusText.nodeValue=C}this.showStatus()},setOkStatus:function(C){this.statusText.nodeValue="";this.statusLine.setAttribute("class","undermark");if(arguments.length>0){this.statusText.nodeValue=C}this.showStatus()},setTitle:function(E,C,D){this[E+"Title"].setAttribute("class",(D)?"undermark":"overmark");this[E+"Title"].innerHTML=C},doIt:function(){u.doIt(this)}};var z=function(E){var G=this;this.section=i.createElement("div");this.section.setAttribute("class","section");var C=i.createElement("h3");var D=i.createElement("span");this.button=i.createElement("a");this.button.setAttribute("class","closed");this.button.setAttribute("href","javascript:void(0);");this.button.addEventListener("click",function(){G.toggle()},false);w.addText(D,h.name);this.button.appendChild(D);C.appendChild(this.button);this.section.appendChild(C);E.appendChild(this.section);this.sectioncontent=i.createElement("div");this.sectioncontent.setAttribute("class","sectioncontent");this.sectioncontent.setAttribute("id",h.name);this.sectioncontent.setAttribute("style","display:none;");this.content=i.createElement("div");this.content.setAttribute("class","contentz");var F=i.createElement("div");F.setAttribute("class","footer");this.sectioncontent.appendChild(this.content);this.sectioncontent.appendChild(F);E.appendChild(this.sectioncontent);this.form=null;this.canLoad=true;this.wTime=30;this.toggleTimer=null};var m=function(E){var C=0,D=0;if(E.offsetParent){do{C+=E.offsetLeft;D+=E.offsetTop}while(E=E.offsetParent)}return{l:C,t:D}};z.prototype={loadForm:function(){this.canLoad=false;if(!a.ready){this.wTime=Math.round(this.wTime*1.1);var C=this;setTimeout(function(){C.loadForm()},this.wTime);return}this.form=new o(this.content);this.form.setErrorStatus(B("e_nod"));if(!this.form.setNewListFromPage()){this.sectioncontent.innerHTML='<div style="color:red;text-align:center;font-weigth:bold;padding:30px">'+B("e_oga")+"</div>"}this.form.load();if(this.form.oldList.value==""){this.form.save("new");this.form.load()}},toggle:function(){if(this.canLoad){this.loadForm()}if(this.button.getAttribute("class")=="closed"){this.button.setAttribute("class","opened");this.sectioncontent.setAttribute("style","display:block;");var D=m(this.section);for(var C=10;C<=100;C+=30){setTimeout(function(){try{d.scroll(D.l,D.t)}catch(E){}},C)}}else{this.button.setAttribute("class","closed");this.sectioncontent.setAttribute("style","display:none;")}}};h.domWait=30;h.domLoader=function(){clearTimeout(this.domTimer);if(i.getElementById("allyInternText")){delete this.dom;this.dom=new z(i.getElementById("eins"))}else{this.domWait=Math.round(this.domWait*1.1);this.domTimer=setTimeout(function(){h.domLoader()},this.domWait)}};h.init=function(){this.domLoader();try{i.querySelector("a.navi.overview").addEventListener("click",function(){h.domWait=30;h.domLoader()},false);var C=i.querySelector("#form_assignRank a.save_bigger");if(C){C.addEventListener("click",function(){h.domWait=30;h.domTimer=setTimeout(function(){h.domLoader()},500)},false)}}catch(D){}};h.init()};var k=function(){if(arguments.callee.done){return}arguments.callee.done=true;if(c){clearInterval(c)}b()};if(i.addEventListener){i.addEventListener("DOMContentLoaded",k,false)}if(/WebKit/i.test(d.navigator.userAgent)){var c=setInterval(function(){if(/loaded|complete/.test(i.readyState)){k()}},10)}d.onload=k})();