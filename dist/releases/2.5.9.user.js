// ==UserScript==
// @name           CerealOgameStats
// @description    Make alliance stats from ogame to post in forums
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/134405.user.js
// @updateURL      https://userscripts.org/scripts/source/134405.meta.js
// @icon           http://s3.amazonaws.com/uso_ss/icon/134405/large.png
// @version        2.5.9
// @include        *://*.ogame.*/game/index.php?*page=alliance*
// ==/UserScript==
/*!

	CerealOgameStats

	Makes alliance stats from the ogame alliance memberdata and
	transforms it into a forum friendly code.

	Copyright (C) 2012 Elías Grande Cásedas

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see http://www.gnu.org/licenses/

*/
(function(){var f=window,j,d;try{if(unsafeWindow){f=unsafeWindow}}catch(h){}j=f.document;d=f.jQuery;var g=function(n){var m=j.createElement("style");m.setAttribute("type","text/css");if(m.styleSheet){m.styleSheet.cssText=n}else{m.appendChild(j.createTextNode(n))}var e=j.getElementsByTagName("head")[0];e.appendChild(m)};g("#member-list {display:none;}");var b={ready:false,list:j.createElement("table"),wait:10};var k=function(){try{var m=j.getElementById("member-list");if(!m){throw 0}else{b.list.innerHTML=m.innerHTML;b.ready=true;delete b.wait;g("#member-list {display:table;}")}}catch(n){b.wait=Math.round(b.wait*1.1);var o=this;setTimeout(k,b.wait)}};k();var i={name:"CerealOgameStats",home:"http://userscripts.org/scripts/show/134405"};String.prototype.replaceAll=function(e,m){return this.split(e).join(m)};String.prototype.recursiveReplaceMap=function(p,o,m){if(m==0){return this.split(p[0]).join(o[0])}var n,e=this.split(p[m]);for(n in e){e[n]=e[n].recursiveReplaceMap(p,o,m-1)}return e.join(o[m])};String.prototype.replaceMap=function(e){var m,p,o,n;p=new Array();o=new Array();n=0;for(m in e){p.push(m);o.push(e[m]);n++}if(n==0){return this}else{return this.recursiveReplaceMap(p,o,n-1)}};String.prototype.trimNaN=function(){return this.replace(/^\D+$/,"").replace(/^\D*(\d)/,"$1").replace(/(\d)\D*$/,"$1")};var a=function(){d=f.jQuery;var s=function(){this.getMeta("version","ogame-version",null);this.getMeta("language","ogame-language","en");this.getMeta("timestamp","ogame-timestamp",null);this.getMeta("universe","ogame-universe",null);this.getMeta("alliance_id","ogame-alliance-id",null);this.getMeta("player_name","ogame-player-name","")};s.prototype={getMeta:function(D,E,F){try{this[D]=j.querySelector('meta[name="'+E+'"]').getAttribute("content")}catch(G){this[D]=F}}};var q=new s();var z={id:function(D){return i.name+"_"+q.universe+"_"+q.alliance_id+"_"+D},set:function(G,D){var E=this.id(G);try{f.localStorage.setItem(E,D)}catch(F){f.localStorage[E]=D}return D},get:function(G){var D=this.id(G);try{return f.localStorage.getItem(D)}catch(E){var F=f.localStorage[D];return(F=="undefined")?null:F}}};var u=function(){this.lc={}};u.prototype={get:function(D){if(this.lc[D]){return this.lc[D]}return D},set:function(E){for(var D in E){this.lc[D]=E[D]}},number:function(I){var H,D,G,E;H=I+"";D=H.split(".");G=D[0];E=D.length>1?this.lc.s_dec+D[1]:"";var F=/(\d+)(\d{3})/;while(F.test(G)){G=G.replace(F,"$1"+this.lc.s_tho+"$2")}return G+E},date:function(D){return D.trimNaN().split(/\D+/).join(this.lc.s_dat)},time:function(D){return D.trimNaN().split(/\D+/).join(this.lc.s_tim)},period:function(J){var E,I,H,D,G=parseInt(J),F="",K=0;E=Math.floor(G/604800);G-=E*604800;I=Math.floor(G/86400);G-=I*86400;H=Math.floor(G/3600);G-=H*3600;D=Math.floor(G/60);G-=D*60;if(E>0){F+=this.number(E)+this.lc.a_wee+" ";K++}if(I>0){F+=this.number(I)+this.lc.a_day+" ";K++}if(H>0||K<1||D+G<1){F+=this.number(H)+this.lc.a_hou+" ";K++}if(D>0||K<2||(K==2&&G<1)){F+=this.number(D)+this.lc.a_min+" ";K++}if(G>0||K<3){F+=this.number(G)+this.lc.a_sec}return F.trim()}};var t=new u();var C=function(D){return t.get(D)};t.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"w",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Select",b_del:"Erase",b_get:"Get from this page",b_sav:'Save as "Old data"',b_loa:"Load saved data",b_res:"Reset stats",t_odt:"Old data",t_ndt:"New data",t_fmt:"Format",t_col:"Colors",t_inc:"Include",t_out:"Statistics (code)",t_stb:"Status",t_pre:"Evolution",t_exp:"Export to forums",p_ago:"{period} ago",p_now:"now",c_dbg:"Dark background",c_lbg:"Light background",e_nod:"No old data",e_nnd:"No new data",e_odf:"The old data has wrong format",e_ndf:"The new data has wrong format",e_unk:"Unexpected error",e_ndt:"No data",e_wft:"Wrong format",w_pcs:"Processing",o_tdt:"Evolution of the alliance since {oldDate} to {newDate}",o_tet:"Elapsed time",o_tas:"Alliance summary",o_ptl:"Total points",o_ppm:"Points per member",o_ttt:"Top 3 by total score",o_tts:"Top 3 by gained score",o_ttp:"Top 3 by gained percent",o_ttg:"Top 3 by gained positions",o_trt:"Total score rank",o_trs:"Gained score rank",o_trp:"Gained percent rank",o_trg:"Gained positions rank",o_tsc:"Special cases",o_cnm:"new member",o_cla:"leaves the alliance",o_bdg:"banned",o_bdq:"unbanned",o_ldt:"Latest data (for future statistics)",o_abt:"Statistics performed with {link}",e_oga:"OGame Error, reload this page may fix it"});if(/es|ar|mx/.test(q.language)){t.set({s_dec:",",s_tho:".",a_wee:"s",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Seleccionar",b_del:"Borrar",b_get:"Obtener de esta página",b_sav:'Guardar como "Datos antiguos"',b_loa:"Cargar datos guardados",b_res:"Resetear estadísticas",t_odt:"Datos antiguos",t_ndt:"Datos nuevos",t_fmt:"Formato",t_col:"Colores",t_inc:"Incluir",t_out:"Estadísticas (código)",t_stb:"Estado",t_pre:"Evolución",t_exp:"Exportar para foros",p_ago:"hace {period}",p_now:"ahora",c_dbg:"Fondo oscuro",c_lbg:"Fondo claro",e_nod:"No hay datos antiguos",e_nnd:"No hay datos nuevos",e_odf:"Los datos antiguos tienen un formato erróneo",e_ndf:"Los datos nuevos tienen un formato erróneo",e_unk:"Error inesperado",e_ndt:"Sin datos",e_wft:"Formato erróneo",w_pcs:"Procesando",o_tdt:"Evolución de la alianza desde el {oldDate} hasta el {newDate}",o_tet:"Tiempo transcurrido",o_tas:"Resumen de la alianza",o_ptl:"Puntos totales",o_ppm:"Puntos por miembro",o_ttt:"Top 3 por puntos totales",o_tts:"Top 3 por puntos subidos",o_ttp:"Top 3 por porcentaje subido",o_ttg:"Top 3 por posiciones subidas",o_trt:"Ranking por puntos totales",o_trs:"Ranking por puntos subidos",o_trp:"Ranking por porcentaje subido",o_trg:"Ranking por posiciones subidas",o_tsc:"Casos especiales",o_cnm:"nuevo miembro",o_cla:"abandona la alianza",o_bdg:"baneado",o_bdq:"desbaneado",o_ldt:"Datos más recientes (para futuras estadísticas)",o_abt:"Estadísticas realizadas con {link}",e_oga:"Error de OGame, recargar esta página puede arreglarlo"})}else{if(/fr/.test(q.language)){t.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"s",a_day:"j",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Sélectionner",b_del:"Effacer",b_get:"Recharger de cette page",b_sav:'Sauvegarder comme "Anciennes données"',b_loa:"Charger anciennes données",b_res:"Réinitialiser les statistiques",t_odt:"Anciennes données",t_ndt:"Nouvelles données",t_fmt:"Format",t_col:"Couleur",t_inc:"Inclure",t_out:"Statistiques (code)",t_stb:"Statut",t_pre:"Évolution",t_exp:"Exporter pour forums",p_ago:"{period} depuis le début",p_now:"maintenant",c_dbg:"Arrière plan foncé",c_lbg:"Arrière plan clair",e_nod:"Pas d'anciennes données",e_nnd:"Pas de nouvelles données",e_odf:"Les anciennes données ont un mauvais format",e_ndf:"Les nouvelles données ont un mauvais format",e_unk:"Erreur inattendu",e_ndt:"Pas de données",e_wft:"Mauvais format",w_pcs:"Traitement en cours",o_tdt:"Évolution de l'alliance du {oldDate} au {newDate}",o_tet:"Temps passé",o_tas:"Résumé de l'alliance ",o_ptl:"Points totaux",o_ppm:"Points par membres",o_ttt:"Top 3 par points totaux",o_tts:"Top 3 par points gagnées",o_ttp:"Top 3 par pourcentage gagné",o_ttg:"Top 3 par places gagnées",o_trt:"Rang par points totaux",o_trs:"Rang par points gagnées",o_trp:"Rang par pourcentage gagné",o_trg:"Rang par places gagnées",o_tsc:"Cas spéciaux",o_cnm:"Nouveaux Membres",o_cla:"A quitté l'alliance",o_bdg:"Banni",o_bdq:"Débanni",o_ldt:"Dernières données (pour statistiques futures)",o_abt:"Statistiques obtenues avec {link}",e_oga:"Erreur OGame, recharger la page peut régler le problème"})}else{if(/tr/.test(q.language)){t.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"h",a_day:"g",a_hou:"s",a_min:"d",a_sec:"s",b_sel:"Seç",b_del:"Sil",b_get:"Bu sayfadankini kullan",b_sav:'"Eski veri" olarak kaydet',b_loa:"Kaydedilen verileri yükle",b_res:"İstatistikleri sıfırla",t_odt:"Eski veri",t_ndt:"Yeni veri",t_fmt:"Biçim",t_col:"Renkler",t_inc:"Ekle",t_out:"İstatistik (code)",t_stb:"Durum",t_pre:"Gelişim",t_exp:"Forumlara Aktar ",p_ago:"{period} önce",p_now:"şimdi",c_dbg:"Koyu arka plan",c_lbg:"Açık arka plan",e_nod:"Eski veri",e_nnd:"Yeni veri yok",e_odf:"Eski veri hatalı formatta",e_ndf:"Yeni veri hatalı formatta",e_unk:"Beklenmeyen hata",e_ndt:"Veri yok",e_wft:"Yanlış format",w_pcs:"İşleniyor",o_tdt:"Gelişim Zaman Aralığı {oldDate} - {newDate} ",o_tet:"Geçen zaman",o_tas:"İttifak Bilgisi",o_ptl:"Toplam Puan",o_ppm:"Üye Başına Ortalama Puan",o_ttt:"Toplam Puana Göre En İyi 3",o_tts:"Puan Artışına Göre En İyi 3",o_ttp:"Yüzdelik Artışa Göre En İyi 3",o_ttg:"Sıra Artışına Göre En İyi 3",o_trt:"Toplam Puana Göre Sıralama",o_trs:"Puan Artışına Göre Sıralama",o_trp:"Yüzdelik Artışa Göre Sıralama",o_trg:"Sıra Artışına Göre Sıralama",o_tsc:"Özel Durumlar",o_cnm:"Yeni Üye",o_cla:"İttifaktan ayrılır",o_bdg:"Yasaklı",o_bdq:"Yasağı kaldırılmış",o_ldt:"Son Veri (Gelecekteki İstatistikler İçin)",o_abt:"{link} tarafından gerçekleştirilen istatistikler",e_oga:"OGame Hatası, Düzeltmek İçin Sayfayı Tekrar Yükleyin"})}else{if(/pt|br/.test(q.language)){t.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"s",a_day:"d",a_hou:"h",a_min:"m",a_sec:"s",b_sel:"Seleccionar",b_del:"Apagar",b_get:"Obter desta página",b_sav:'Gravar como "Informação antiga"',b_loa:"Carregar informação gravada",b_res:"Recomeçar",t_odt:"Informação antiga",t_ndt:"Informação nova",t_fmt:"Formato",t_col:"Cores",t_inc:"Incluir",t_out:"Estatísticas (código)",t_stb:"Estado",t_pre:"Evolução",t_exp:"Exportar para foruns",p_ago:"{period} atrás",p_now:"agora",c_dbg:"Fundo escuro",c_lbg:"Fundo claro",e_nod:"Sem informação antiga",e_nnd:"Sem informação nova",e_odf:"A informação antiga tem formato errado",e_ndf:"A informação nova tem formato errado",e_unk:"Erro inesperado",e_ndt:"Sem informação",e_wft:"Formato errado",w_pcs:"Processar",o_tdt:"Evolução da aliança desde {oldDate} até {newDate}",o_tet:"Tempo decorrido",o_tas:"Sumario da aliança",o_ptl:"Pontos totais",o_ppm:"Pontos por membro",o_ttt:"Top 3 por pontos totais",o_tts:"Top 3 por pontos ganhos",o_ttp:"Top 3 por percentagem ganha",o_ttg:"Top 3 por posições ganhas",o_trt:"Classificação total de pontos",o_trs:"Classificação pontos ganhos",o_trp:"Classificação percentagem ganha",o_trg:"Classificação posições ganhos",o_tsc:"Casos especiais",o_cnm:"novo membro",o_cla:"deixou aliança",o_bdg:"banido",o_bdq:"ex-banido",o_ldt:"Ultima data (para futura estatística)",o_abt:"Estatísticas realizadas por {link}"})}else{if(/it/.test(q.language)){t.set({s_dec:".",s_tho:",",s_dat:"/",s_tim:":",a_wee:"s",a_day:"g",a_hou:"o",a_min:"m",a_sec:"s",b_sel:"Seleziona",b_del:"Cancella",b_get:"Copia dalla pagina",b_sav:'Salva come "Dati vecchi"',b_loa:"Carica dati salvati",b_res:"Resetta le statistiche",t_odt:"Dati vecchi",t_ndt:"Nuovi dati",t_fmt:"Formato",t_col:"Colori",t_inc:"Includi",t_out:"Statistiche (codice)",t_stb:"Status",t_pre:"Progresso",t_exp:"Esporta per il forum",p_ago:"{period} fa",p_now:"ora",c_dbg:"Sfondo scuro",c_lbg:"Sfondo chiaro",e_nod:"Nessun dato vecchio",e_nnd:"Nessun dato nuovo",e_odf:"I dati vecchi hanno un formato sbagliato",e_ndf:"I dati nuovi hanno un formato sbagliato",e_unk:"Errore generico",e_ndt:"Nessu dato",e_wft:"Formato errato",w_pcs:"In elaborazione",o_tdt:"Progresso alleanza da {oldDate} a {newDate}",o_tet:"Tempo trascorso",o_tas:"Sommario alleanza",o_ptl:"Punti totali",o_ppm:"Punti per Player",o_ttt:"Top 3 punteggio totale",o_tts:"Top 3 punti guadagnati",o_ttp:"Top 3 percentuale punti guadagnati",o_ttg:"Top 3 posizioni guadagnate",o_trt:"Classifica punteggio totale",o_trs:"Classifica punti guadagnati",o_trp:"Classifica percentuale punti guadagnati",o_trg:"Classifica posizioni guadagnate",o_tsc:"Casi speciali",o_cnm:"nuovo alleato",o_cla:"ha lasciato l alleanza",o_bdg:"bannato",o_bdq:"sbannato",o_ldt:"Dati salvati (per statistiche future)",o_abt:"Statistiche create da {link}",e_oga:"Errore di Ogame, ricarica la pagina"})}}}}}var B=function(){this.names=new Array();this.colors=new Array();this.selected=null};B.prototype={add:function(E,D){this.names.push(E);this.colors.push(D)},select:function(D){this.selected=this.colors[D]},replace:function(D){return D.replaceMap(this.selected)}};var r=new B();r.add(C("c_dbg"),{"{nameColor}":"white","{growsColor}":"#00FF40","{decreasesColor}":"#ED7010","{remainsColor}":"#00DDDD"});r.add(C("c_lbg"),{"{nameColor}":"purple","{growsColor}":"green","{decreasesColor}":"red","{remainsColor}":"blue"});var o={diffScore:function(D,G){var F=G-D;var E=((G/D)-1)*100;return{score:F,percent:E}}};var m=function(){this.formats=new Array();this.selected=null;this.escapeMap={"[":"[[u][/u]","]":"[u][/u]]"};this.lastReplace={"{grows}":"\u00BB","{decreases}":"\u00AB","{remains}":"\u007E","{remainsNo}":"\u00D8","{up}":"\u2191","{down}":"\u2193","{rank}":"#","{\\":"{","\\}":"}"};this.layout={sectionStart:"[size=big]{title}[/size]",sectionEnd:"\n\n",dateTime:"{date} ([i]{time}[/i])",header:"[b]{title}[/b]\n{elapsedTitle}: {elapsedTime}\n\n",allianceLine:"\n[color={diffColor}]{diff}[/color] [b][color={nameColor}]{title}[/color][/b] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",top3TScoreLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ({newScore})",top3ScoreLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffScore}[/color][/b])",top3PercentLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",top3PositionsLine:"\n[color={diffColor}]{position} {diff} [/color] [color={nameColor}][b]{name}[/b][/color] ([b][color={diffColor}]{diffPos}[/color][/b])",rankLine:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {newScore} ([b][color={diffColor}]{diffScore}[/color][/b]) ([b][color={diffColor}]{diffPercent}[/color][/b] [color={diffColor}][size=small]%[/size][/color])",rank:" [size=small]{rank}[/size]{newPos} ([b][color={diffColor}]{diffPos}[/color][/b])",rankNoDiff:" [size=small]{rank}[/size]{newPos} ([b][color={remainsColor}]{remainsNo}[/color][/b])",rankLineNoDiff:"\n[color={diffColor}]{position} {diff} [/color][color={nameColor}][b]{name}[/b][/color] - {oldScore} ([b][color={remainsColor}]{remainsNo}[/color][/b])",from0Member:"\n[color={growsColor}]{grows} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={growsColor}]{score}[/color][/b] [size=small]({reason})[/size]",to0Member:"\n[color={decreasesColor}]{decreases} [/color] [color={nameColor}][b]{name}[/b][/color] - [b][color={decreasesColor}]{score}[/color][/b] [size=small]({reason})[/size]",scriptData:"\n[i]{scriptDataTitle}:[/i]\n[spoiler][code]{scriptData}[/code][/spoiler]",scriptLink:"\n[i]"+C("o_abt").replace("{link}","[url={scriptHome}]{scriptName}[/url]")+"[/i]"}};m.prototype={add:function(D,E){this.formats.push({name:D,patterns:E,escapeMap:(arguments.length>2)?arguments[2]:false})},select:function(D){this.selected=this.formats[D]},escape:function(D){if(this.selected.escapeMap){return D.replaceMap(this.selected.escapeMap)}else{return D.replaceMap(this.escapeMap)}},diff:function(E,F){var D=E;if(F<0){D=D.replaceMap({"{diffColor}":"{decreasesColor}","{diff}":"{decreases}"})}else{if(F>0){D=D.replaceMap({"{diffColor}":"{growsColor}","{diff}":"{grows}"})}else{D=D.replaceMap({"{diffColor}":"{remainsColor}","{diff}":"{remains}"})}}return D},header:function(D){return this.layout.header.replaceMap({"{title}":C("o_tdt").replaceMap({"{oldDate}":this.layout.dateTime.replaceMap({"{date}":D.oldDate,"{time}":D.oldTime}),"{newDate}":this.layout.dateTime.replaceMap({"{date}":D.newDate,"{time}":D.newTime})}),"{elapsedTitle}":C("o_tet"),"{elapsedTime}":this.escape(t.period(D.newTimestamp-D.oldTimestamp))})},alliance:function(D){if(D.oldScore==0){return""}return this.layout.sectionStart.replaceAll("{title}",C("o_tas"))+this.diff(this.layout.allianceLine,D.diffScore).replaceMap({"{title}":C("o_ptl"),"{newScore}":D.formatted.newScore,"{diffScore}":D.formatted.diffScore,"{diffPercent}":D.formatted.diffPercent})+this.diff(this.layout.allianceLine,D.diffMemberScore).replaceMap({"{title}":C("o_ppm"),"{newScore}":D.formatted.newMemberScore,"{diffScore}":D.formatted.diffMemberScore,"{diffPercent}":D.formatted.diffMemberPercent})+this.layout.sectionEnd},position:function(I,D){var E=I+"",H=(E).length,G=(D+"").length;for(var F=H;F<G;F++){E="0"+E}return E},top3:function(G,I,K,D){var F=(this.layout.sectionStart+"").replace("{title}",K);var E=Math.min(G.length,3);var H,J;for(H=0;H<E;H++){J=G[H];F=F+this.diff(D,J.diffScore).replaceMap({"{position}":this.position(H+1,E),"{name}":this.escape(J.name),"{diffPos}":J.formatted.diffPos.replaceMap({"+":"{up}","-":"{down}"})}).replaceAll("{"+I+"}",J.formatted[I])}return F+this.layout.sectionEnd},rank:function(F,J){var E=(this.layout.sectionStart+"").replace("{title}",J);var D=F.length;var G,I;for(G=0;G<D;G++){I=F[G];var H=(I.diffScore==0)?this.layout.rankLineNoDiff:this.layout.rankLine;E=E+this.diff(H,I.diffScore).replaceMap({"{position}":this.position(G+1,D),"{name}":this.escape(I.name),"{oldScore}":I.formatted.oldScore,"{newScore}":I.formatted.newScore,"{diffScore}":I.formatted.diffScore,"{diffPercent}":I.formatted.diffPercent});H=(I.diffPos==0)?this.layout.rankNoDiff:this.layout.rank;E=E+this.diff(H,I.diffPos).replaceMap({"{newPos}":I.formatted.newPos,"{diffPos}":I.formatted.diffPos.replaceMap({"+":"{up}","-":"{down}"})})}return E+this.layout.sectionEnd},specialCases:function(F,G){if((F.length+G.length)==0){return""}var D=this.layout.sectionStart.replace("{title}",C("o_tsc"));var E,H;for(E in G){H=G[E];D=D+this.layout.from0Member.replaceMap({"{name}":this.escape(H.name),"{score}":H.score,"{reason}":H.reason})}for(E in F){H=F[E];D=D+this.layout.to0Member.replaceMap({"{name}":this.escape(H.name),"{score}":H.score,"{reason}":H.reason})}return D+this.layout.sectionEnd},format:function(F,I,N,J,M,K){var H=this.header(I);if(F.alliance){H=H+this.alliance(I)}var L="";var G="";var O="";var R="";var E="";var D="";var P="";var Q="";if(N.length>0){N=N.sort(function(T,S){if(T.newScore==S.newScore){return(T.diffScore>=S.diffScore)?-1:1}else{return(T.newScore>=S.newScore)?-1:1}});if(F.top3TScore&&(N.length>5||!F.tScore)){G=this.top3(N,"newScore",C("o_ttt"),this.layout.top3TScoreLine)}if(F.tScore){E=this.rank(N,C("o_trt"))}N=N.sort(function(T,S){if(T.diffScore==S.diffScore){if(T.diffPercent==S.diffPercent){return(T.newScore>=S.newScore)?-1:1}else{return(T.diffPercent>=S.diffPercent)?-1:1}}else{return(T.diffScore>=S.diffScore)?-1:1}});if(F.top3Score&&(N.length>5||!F.score)){L=this.top3(N,"diffScore",C("o_tts"),this.layout.top3ScoreLine)}if(F.score){D=this.rank(N,C("o_trs"))}N=N.sort(function(T,S){if(T.diffPercent==S.diffPercent){if(T.diffScore==S.diffScore){return(T.newScore>=S.newScore)?-1:1}else{return(T.diffScore>=S.diffScore)?-1:1}}else{return(T.diffPercent>=S.diffPercent)?-1:1}});if(F.top3Percent&&(N.length>5||!F.percent)){O=this.top3(N,"diffPercent",C("o_ttp"),this.layout.top3PercentLine)}if(F.percent){P=this.rank(N,C("o_trp"))}N=N.sort(function(T,S){if(T.diffPos==S.diffPos){if(T.diffScore==S.diffScore){if(T.diffPercent==S.diffPercent){return(T.newScore>=S.newScore)?-1:1}else{return(T.diffPercent>=S.diffPercent)?-1:1}}else{return(T.diffScore>=S.diffScore)?-1:1}}else{return(T.diffPos>=S.diffPos)?-1:1}});if(F.top3Positions&&(N.length>5||!F.positions)){R=this.top3(N,"diffPos",C("o_ttg"),this.layout.top3PositionsLine)}if(F.positions){Q=this.rank(N,C("o_trg"))}}H=H+G+L+O+R+E+D+P+Q;if(F.special){H=H+this.specialCases(J,M)}if(F.data){H=H+this.layout.scriptData.replace("{scriptDataTitle}",C("o_ldt"))}H=H+this.layout.scriptLink;H=H.replaceMap(this.selected.patterns).replaceMap(r.selected).replaceMap({"{scriptName}":i.name,"{scriptHome}":i.home}).replaceMap(this.lastReplace).replace("{scriptData}",K.replaceMap({"<":"\\u003C",">":"\\u003E","[":"\\u005B","]":"\\u005D"}));return H.trim()}};var w=new m();w.add("phpBB",{"[size=big]":"[size=20]","[size=small]":"[size=10]"});w.add("phpBB3",{"[size=big]":"[size=140]","[size=small]":"[size=80]"});w.add("SMF",{"[size=big]":"[size=14pt]","[size=small]":"[size=7pt]"});w.add("vBulletin",{"[size=big]":"[size=4]","[size=small]":"[size=1]"});w.add("HTML",{"{grows}":"&raquo;","{decreases}":"&laquo;","{remains}":"&sim;","{remainsNo}":"&Oslash;","{up}":"&uarr;","{down}":"&darr;","[size=big]":'<span style="font-size: 140%;">',"[size=small]":'<span style="font-size: 80%;">',"[/size]":"</span>","[color={":'<span style="color: {',"Color}]":'Color}">',"[/color]":"</span>","[b]":"<b>","[/b]":"</b>","[i]":"<i>","[/i]":"</i>","\n":"<br />\n","[spoiler]":"<div>","[/spoiler]":"</div>","[code]":'<textarea onclick="this.select();" rows="5" cols="20">',"[/code]":"</textarea>","[url={scriptHome}]{scriptName}[/url]":'<a href="{scriptHome}">{scriptName}</a>'},{"&":"&amp;","<":"&lt;",">":"&gt;"});var y=function(){};y.prototype={reset:function(){this.allyInfo={oldCount:0,oldScore:0,newCount:0,newScore:0};this.membersInfo=new Array();this.oldMembersInfo=new Array();this.newMembersInfo=new Array();this.to0MembersInfo=new Array();this.from0MembersInfo=new Array()},readData:function(G,F){var D,E=JSON.parse(G);this.allyInfo[F+"Timestamp"]=E.timestamp;this.allyInfo[F+"Date"]=E.strDate;this.allyInfo[F+"Time"]=E.strTime;for(D in E.members){this[F+"MembersInfo"].push({id:("i" in E.members[D])?E.members[D].i:-1,name:D,score:E.members[D].s,pos:E.members[D].p,coord:E.members[D].c,date:E.members[D].d,noPartner:true});this.allyInfo[F+"Count"]++;this.allyInfo[F+"Score"]=this.allyInfo[F+"Score"]+E.members[D].s}return E},merge:function(){var I,G,L,F,H,D,J;L=this.allyInfo.oldCount;for(I in this.newMembersInfo){H=this.newMembersInfo[I];for(G=0;G<L;G++){F=this.oldMembersInfo[G];if((F.noPartner)&&(((F.id>=0)&&(F.id==H.id))||(F.name==H.name)||(F.coord==H.coord))){break}}if(G!=L){this.oldMembersInfo[G].noPartner=false;this.newMembersInfo[I].noPartner=false;if((H.score==0)||(H.pos==0)){this.to0MembersInfo.push({name:H.name,score:t.number(F.score),reason:C("o_bdg")})}else{if((F.score==0)||(F.pos==0)){this.from0MembersInfo.push({name:H.name,score:t.number(H.score),reason:C("o_bdq")})}else{J=o.diffScore(F.score,H.score);D={name:H.name,oldScore:F.score,newScore:H.score,oldPos:F.pos,newPos:H.pos,diffPos:F.pos-H.pos,diffScore:J.score,diffPercent:J.percent};D.formatted={oldScore:t.number(D.oldScore),newScore:t.number(D.newScore),oldPos:t.number(D.oldPos.toFixed()),newPos:t.number(D.newPos.toFixed()),diffPos:((D.diffPos<0)?"":"+")+t.number(D.diffPos.toFixed()),diffScore:((D.diffScore<0)?"":"+")+t.number(D.diffScore.toFixed()),diffPercent:((D.diffPercent<0)?"":"+")+t.number(D.diffPercent.toFixed(2))};this.membersInfo.push(D)}}}}var E,K;for(K in this.newMembersInfo){E=this.newMembersInfo[K];if(E.noPartner){this.from0MembersInfo.push({name:E.name,score:t.number(E.score),reason:C("o_cnm")})}}for(K in this.oldMembersInfo){E=this.oldMembersInfo[K];if(E.noPartner){this.to0MembersInfo.push({name:E.name,score:t.number(E.score),reason:C("o_cla")})}}this.to0MembersInfo.sort(function(N,M){return parseInt(N.score)-parseInt(M.score)});this.from0MembersInfo.sort(function(N,M){return parseInt(M.score)-parseInt(N.score)});delete this.oldMembersInfo;delete this.newMembersInfo;J=o.diffScore(this.allyInfo.oldScore,this.allyInfo.newScore);this.allyInfo.diffScore=J.score;this.allyInfo.diffPercent=J.percent;this.allyInfo.oldMemberScore=this.allyInfo.oldScore/this.allyInfo.oldCount;this.allyInfo.newMemberScore=this.allyInfo.newScore/this.allyInfo.newCount;J=o.diffScore(this.allyInfo.oldMemberScore,this.allyInfo.newMemberScore);this.allyInfo.diffMemberScore=J.score;this.allyInfo.diffMemberPercent=J.percent;this.allyInfo.formatted={oldScore:t.number(this.allyInfo.oldScore),newScore:t.number(this.allyInfo.newScore),diffScore:((this.allyInfo.diffScore<0)?"":"+")+t.number(this.allyInfo.diffScore.toFixed()),diffPercent:((this.allyInfo.diffPercent<0)?"":"+")+t.number(this.allyInfo.diffPercent.toFixed(2)),oldMemberScore:t.number(this.allyInfo.oldMemberScore.toFixed()),newMemberScore:t.number(this.allyInfo.newMemberScore.toFixed()),diffMemberScore:((this.allyInfo.diffMemberScore<0)?"":"+")+t.number(this.allyInfo.diffMemberScore.toFixed()),diffMemberPercent:((this.allyInfo.diffMemberPercent<0)?"":"+")+t.number(this.allyInfo.diffMemberPercent.toFixed(2))}},doIt:function(H){H.setStats();H.setPreview();w.select(parseInt(H.selectFormat.selectedIndex));r.select(parseInt(H.selectColors.selectedIndex));H.setOkStatus(C("w_pcs")+"...");this.reset();var I,K,G=false;if(H.oldList.value.trim()==""){H.setErrorStatus(C("e_nod"));H.setTitle("old",C("e_ndt"),false);G=true}if(!G){try{I=this.readData(H.oldList.value,"old");K=I.strDate+" (<i>"+I.strTime+"</i>) &rarr; "+((q.timestamp==I.timestamp)?C("p_now"):C("p_ago").replace("{period}",t.period(q.timestamp-I.timestamp)));if(this.oldMembersInfo.length==0||/NaN|undefined/.test(K)){throw 0}H.setTitle("old",K,true)}catch(J){H.setTitle("old",C("e_wft"),false);H.setErrorStatus(C("e_odf"));G=true}}if(H.newList.value.trim()==""){H.setErrorStatus(C("e_nnd"));H.setTitle("new",C("e_ndt"),false);return}try{I=this.readData(H.newList.value,"new");K=I.strDate+" (<i>"+I.strTime+"</i>) &rarr; "+((q.timestamp==I.timestamp)?C("p_now"):C("p_ago").replace("{period}",t.period(q.timestamp-I.timestamp)));if(this.newMembersInfo.length==0||/NaN|undefined/.test(K)){throw 0}H.setTitle("new",K,true);if(G){return}}catch(J){H.setErrorStatus(C("e_ndf"));return}try{this.merge();var D={alliance:H.doAlliance.checked,top3TScore:H.doTop3TScore.checked,top3Score:H.doTop3Score.checked,top3Percent:H.doTop3Percent.checked,top3Positions:H.doTop3Positions.checked,tScore:H.doTScore.checked,score:H.doScore.checked,percent:H.doPercent.checked,positions:H.doPositions.checked,special:H.doSpecial.checked,data:H.doData.checked};H.setStats(w.format(D,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,H.newList.value.trim()));D.data=false;w.select(w.formats.length-1);r.select(0);var F="[color={nameColor}][b]{name}[/b][/color]".replaceMap(w.selected.patterns).replaceAll("{name}",q.player_name);var E=F.replaceAll("{nameColor}","#FF0");F=F.replaceMap(r.selected);H.setPreview(w.format(D,this.allyInfo,this.membersInfo,this.to0MembersInfo,this.from0MembersInfo,H.newList.value.trim()).replaceAll(w.selected.patterns["[size=small]"],"<span>").replaceAll(w.selected.patterns["[size=big]"],'<span style="font-size:20px">').replaceAll(F,E));H.hideStatus()}catch(J){H.setErrorStatus(C("e_unk")+": "+J)}}};var v=new y();var e=function(){};e.prototype={addTextarea:function(E){var D=j.createElement("textarea");D.setAttribute("cols","120");D.setAttribute("rows","40");D.setAttribute("class","textBox");E.appendChild(D);return D},addSelect:function(E){var D=j.createElement("select");D.setAttribute("class","dropdown");E.appendChild(D);return D},addOption:function(G,F,E){var D=j.createElement("option");D.appendChild(j.createTextNode(G));D.setAttribute("value",F);E.appendChild(D);return D},addAnchor:function(E,F){var D=j.createElement("a");D.setAttribute("href","javascript:void(0);");D.setAttribute("class",i.name);D.appendChild(j.createTextNode(F));E.appendChild(D);return D},addTitle:function(E,F){var D=j.createElement("b");D.appendChild(j.createTextNode(F));D.setAttribute("style","display:block;font-size:12px");E.appendChild(D);return D},newCell:function(){var D=j.createElement("td");return D},addText:function(E,F){var D=j.createTextNode(F);E.appendChild(D);return D},addBr:function(D){D.appendChild(j.createElement("br"))},addEvent:function(F,E,D){F.addEventListener(E,D,false)},addOnChange:function(E,D){E.addEventListener("change",D,false);E.addEventListener("keyup",D,false)},cancelBubble:function(E){var D=E?E:f.event;if(D.stopPropagation){D.stopPropagation()}if(D.cancelBubble!=null){D.cancelBubble=true}},addCheckbox:function(F,J,K,I,H){var D=j.createElement("input");D.setAttribute("type","checkbox");D.setAttribute("id",i.name+"_"+K);D.setAttribute("style","cursor:pointer;");F.appendChild(D);var E=j.createElement("label");E.setAttribute("for",i.name+"_"+K);E.setAttribute("style","cursor:pointer;");E.innerHTML="&nbsp;"+J;F.appendChild(E);this.addBr(F);var G=z.get(K);D.checked=(G==null)?I:(parseInt(G)==1);z.set(K,(D.checked)?1:0);D.addEventListener("change",function(){z.set(K,(D.checked)?1:0);H()},false);E.addEventListener("mouseover",function(){E.setAttribute("class","undermark")},false);E.addEventListener("mouseout",function(){E.removeAttribute("class")},false);return D},makeTogleable:function(K,O,L,G){var M=j.createElement("a");M.setAttribute("class",i.name+"_toggle_button");var H=G;if(H){var E=i.name+(new Date()).getTime();M.setAttribute("href","#"+E);M.setAttribute("id",E);M.addEventListener("click",x.cancelBubble,false)}else{M.setAttribute("href","javascript:void(0);")}var F=(K.length)?K:new Array(K);var D=true;var J=function(){D=true;for(var P in F){F[P].removeAttribute("style")}L.setAttribute("class",L.getAttribute("class").replace("_toggle_bar_open","_toggle_bar_close"))};var N=function(){D=false;for(var P in F){F[P].setAttribute("style","display:none;")}L.setAttribute("class",L.getAttribute("class").replace("_toggle_bar_close","_toggle_bar_open"))};var I=function(){if(D){N()}else{J()}if(H){M.click()}};L.setAttribute("class",L.hasAttribute("class")?L.getAttribute("class")+" "+i.name+"_toggle_bar_close":i.name+"_toggle_bar_close");L.addEventListener("click",I,false);I();O.setAttribute("style","position:relative;");O.appendChild(M);return{open:J,close:N,toggle:I}},addCss:g,ogameDropDown:function(L){var I,H,F=d(".dropdown.dropdownList").get(),G,J,D,E,M;try{L.ogameDropDown()}catch(K){L.css("visibility","visible");return false}M={select:L};E=function(){var O,N;O=M.select.val();N=M.select.find('[value="'+O+'"]').text();M.dropdown.attr("data-value",O).text(N)};G=d(".dropdown.dropdownList").get();for(I=0;I<F.length;I++){F[I]=d(F[I])}for(I=0;I<G.length;I++){G[I]=d(G[I]);D=G[I].attr("id");J=true;for(H=0;H<F.length;H++){if(F[H].attr("id")==D){J=false;break}}if(J){M.dropdown=d('.dropdown [rel="'+D+'"]');E();L.change(E);break}}return true}};var x=new e();x.addCss("#"+i.name+" table{width: 610px !important;}#"+i.name+" textarea{width: 350px !important;height: 70px !important;margin: 0 !important;padding: 5px !important;}#"+i.name+" a."+i.name+"{display: block !important;padding: 5px 0 0 0 !important;}#"+i.name+" select{width: 250px !important;}#"+i.name+" td{border-top: 2px dotted #242E38 !important;padding: 5px !important;text-align: left !important;}tr.alt #"+i.name+" td{border-top: 2px dotted #24292E !important;}#"+i.name+" td.col2{width: 364px !important;}#"+i.name+" tr.tit td{border-top: none !important;line-height: 18px !important;}td#"+i.name+"_preview{border-top: 2px dotted #242E38 !important;color: #6F9FC8 !important;}#"+i.name+"_preview div{padding-top: 5px !important;padding-bottom: 5px !important;}#"+i.name+"_preview a{display: inline !important;padding: 0 !important;}."+i.name+"_toggle_button{background-color: transparent !important;background-image: url('http://gf2.geo.gfsrv.net/cdn71/fc7a8ede3499a0b19ea17613ff0cb1.gif') !important;display  : block !important;position : absolute !important;top      : 0 !important;right    : 0 !important;height   : 18px !important;width    : 20px !important;}."+i.name+"_toggle_bar_open,."+i.name+"_toggle_bar_close{cursor: pointer !important;}."+i.name+"_toggle_bar_open ."+i.name+"_toggle_button{background-position: 0 0 !important;}."+i.name+"_toggle_bar_close ."+i.name+"_toggle_button{background-position: 0 -18px !important;}."+i.name+"_toggle_bar_open:hover ."+i.name+"_toggle_button{background-position: -20px 0 !important;}."+i.name+"_toggle_bar_close:hover ."+i.name+"_toggle_button{background-position: -20px -18px !important;}");var p=function(P){var G,L,E,O,H,Q,I,J,F,M,K,D;H=this;J=function(){H.doIt()};var N=/WebKit|Gecko|Presto/i.test(f.navigator.userAgent);this.table=j.createElement("table");this.table.setAttribute("cellpadding","0");this.table.setAttribute("cellspacing","0");this.table.setAttribute("class","members bborder");P.appendChild(this.table);G=j.createElement("tbody");this.table.appendChild(G);L=j.createElement("tr");L.setAttribute("class","tit alt");G.appendChild(L);E=x.newCell();E.setAttribute("colspan","2");E.setAttribute("class","col2");M=j.createElement("div");x.addTitle(M,C("t_inc")+":");E.appendChild(M);L.appendChild(E);K=L;L=j.createElement("tr");L.setAttribute("class","alt");G.appendChild(L);L.appendChild(x.newCell());E=x.newCell();E.setAttribute("class","col2");this.doAlliance=x.addCheckbox(E,C("o_tas"),"doAlliance",true,J);this.doTop3TScore=x.addCheckbox(E,C("o_ttt"),"doTop3TScore",false,J);this.doTop3Score=x.addCheckbox(E,C("o_tts"),"doTop3Score",false,J);this.doTop3Percent=x.addCheckbox(E,C("o_ttp"),"doTop3Percent",false,J);this.doTop3Positions=x.addCheckbox(E,C("o_ttg"),"doTop3Positions",false,J);this.doTScore=x.addCheckbox(E,C("o_trt"),"doTScore",false,J);this.doScore=x.addCheckbox(E,C("o_trs"),"doScore",true,J);this.doPercent=x.addCheckbox(E,C("o_trp"),"doPercent",true,J);this.doPositions=x.addCheckbox(E,C("o_trg"),"doPositions",false,J);this.doSpecial=x.addCheckbox(E,C("o_tsc"),"doSpecial",true,J);this.doData=x.addCheckbox(E,C("o_ldt"),"doData",true,J);L.appendChild(E);if(N){x.makeTogleable(L,M,K,false)}L=j.createElement("tr");L.setAttribute("class","tit");G.appendChild(L);E=x.newCell();E.setAttribute("colspan","2");E.setAttribute("class","col2");M=j.createElement("div");x.addTitle(M,C("t_pre")+":");E.appendChild(M);L.appendChild(E);K=L;L=j.createElement("tr");G.appendChild(L);E=x.newCell();E.setAttribute("colspan","2");E.setAttribute("id",i.name+"_preview");L.appendChild(E);if(N){x.makeTogleable(L,M,K,false).open()}E.appendChild(this.preview=j.createElement("div"));this.previewRow=L;this.setPreview();L=j.createElement("tr");L.setAttribute("class","alt tit");G.appendChild(L);E=x.newCell();x.addTitle(E,C("t_odt")+":");L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");M=j.createElement("div");this.oldTitle=j.createElement("span");M.appendChild(this.oldTitle);E.appendChild(M);L.appendChild(E);K=L;L=j.createElement("tr");L.setAttribute("class","alt");G.appendChild(L);E=x.newCell();O=x.addAnchor(E,C("b_sel"));O.addEventListener("click",function(){H.oldList.select()},false);O=x.addAnchor(E,C("b_del"));O.addEventListener("click",function(){H.setOldList()},false);O=x.addAnchor(E,C("b_loa"));O.addEventListener("click",function(){H.load()},false);O=x.addAnchor(E,C("b_sav"));O.addEventListener("click",function(){H.save("old")},false);L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");this.oldList=x.addTextarea(E);x.addOnChange(this.oldList,J,false);L.appendChild(E);if(N){x.makeTogleable(L,M,K,true)}L=j.createElement("tr");L.setAttribute("class","tit");G.appendChild(L);E=x.newCell();x.addTitle(E,C("t_ndt")+":");L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");M=j.createElement("div");this.newTitle=j.createElement("span");M.appendChild(this.newTitle);E.appendChild(M);L.appendChild(E);K=L;L=j.createElement("tr");G.appendChild(L);E=x.newCell();O=x.addAnchor(E,C("b_sel"));O.addEventListener("click",function(){H.newList.select()},false);O=x.addAnchor(E,C("b_del"));O.addEventListener("click",function(){H.setNewList()},false);O=x.addAnchor(E,C("b_get"));O.addEventListener("click",function(){H.setNewListFromPage()},false);O=x.addAnchor(E,C("b_sav"));O.addEventListener("click",function(){H.save("new")},false);O.setAttribute("title",C("b_svt"));L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");this.newList=x.addTextarea(E);x.addOnChange(this.newList,J,false);L.appendChild(E);if(N){x.makeTogleable(L,M,K,true)}L=j.createElement("tr");L.setAttribute("class","tit alt");G.appendChild(L);E=x.newCell();E.setAttribute("colspan","2");E.setAttribute("class","col2");M=j.createElement("div");x.addTitle(M,C("t_exp")+":");E.appendChild(M);L.appendChild(E);K=L;F=new Array();L=j.createElement("tr");L.setAttribute("class","alt");G.appendChild(L);E=x.newCell();x.addText(E,C("t_fmt")+":");L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");this.selectFormat=x.addSelect(E);for(Q in w.formats){x.addOption(w.formats[Q].name,Q,this.selectFormat)}I=z.get("selectFormat");this.selectFormat.selectedIndex=(I==null)?0:parseInt(I);d(this.selectFormat).change(function(){z.set("selectFormat",H.selectFormat.selectedIndex+"");J()});L.appendChild(E);F.push(L);x.ogameDropDown(d(this.selectFormat));L=j.createElement("tr");L.setAttribute("class","alt");G.appendChild(L);E=x.newCell();x.addText(E,C("t_col")+":");L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");this.selectColors=x.addSelect(E);for(Q in r.names){x.addOption(r.names[Q],Q,this.selectColors)}I=z.get("selectColors");this.selectColors.selectedIndex=(I==null)?0:parseInt(I);d(this.selectColors).change(function(){z.set("selectColors",H.selectColors.selectedIndex+"");J()});L.appendChild(E);F.push(L);x.ogameDropDown(d(this.selectColors));L=j.createElement("tr");L.setAttribute("class","alt");G.appendChild(L);E=x.newCell();x.addText(E,C("t_out")+":");O=x.addAnchor(E,C("b_sel"));O.addEventListener("click",function(){H.stats.select()},false);L.appendChild(E);E=x.newCell();E.setAttribute("class","col2");this.stats=x.addTextarea(E);this.stats.setAttribute("readonly","readonly");this.stats.addEventListener("click",function(){H.stats.select()},false);L.appendChild(E);F.push(L);if(N){x.makeTogleable(F,M,K,true)}L=j.createElement("tr");L.setAttribute("class","tit");G.appendChild(L);E=x.newCell();E.setAttribute("class","col2");E.setAttribute("align","right");E.setAttribute("colspan","2");L.appendChild(E);O=x.addAnchor(E,C("b_res"));O.setAttribute("class","action btn_blue float_right");O.addEventListener("click",function(){H.resetData()},false);this.statusRow=(L=j.createElement("tr"));L.setAttribute("class","alt tit");G.appendChild(L);E=x.newCell();x.addTitle(E,C("t_stb")+":");L.appendChild(E);this.statusLine=(E=x.newCell());E.setAttribute("class","col2");this.statusText=x.addText(E,"");L.appendChild(E);this.hideStatus()};p.prototype={load:function(){this.setOldList(z.get("oldData"))},save:function(D){z.set("oldData",this[D+"List"].value)},setOldList:function(D){if(arguments.length>0){this.oldList.value=D}else{this.oldList.value=""}this.doIt()},setNewList:function(D){if(arguments.length>0){this.newList.value=D}else{this.newList.value=""}this.doIt()},resetData:function(){this.setNewListFromPage();this.setOldList(this.currentPageData);z.set("oldData",this.currentPageData)},setStats:function(D){if(arguments.length>0){this.stats.value=D}else{this.stats.value=""}},setPreview:function(D){if(arguments.length>0){this.preview.innerHTML=D}else{this.preview.innerHTML=""}},setNewListFromPage:function(){if(this.currentPageData){this.setNewList(this.currentPageData);return}var I=j.getElementById("OGameClock");if(I==null){I=j.querySelector("li.OGameClock")}var L={timestamp:q.timestamp,strDate:t.date(I.innerHTML.split("<")[0]),strTime:t.time(I.getElementsByTagName("span")[0].innerHTML),members:{}};var Q=b.list.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(var N=0;N<Q.length;N++){var M=Q[N].getElementsByTagName("td");var J=M[0].innerHTML.trim();var K;var E=M[2].getElementsByTagName("select");if(E.length>0){K=E[0].options[E[0].selectedIndex].innerHTML}else{K=M[2].innerHTML}K=K.trim();var H=M[3].getElementsByTagName("span");if(H.length>0){H=H[0]}else{H=M[3]}var O=H.getElementsByTagName("a")[0];H=H.getAttribute("title");H=parseInt(H.replace(/\D/gi,""));var D=O.getAttribute("href");D=parseInt(D.replace(/^.*searchRelId\=(\d+)(\D.*)?$/,"$1"));O=parseInt(O.innerHTML.replace(/\D/gi,""));var P=M[4].getElementsByTagName("a")[0].innerHTML;P=P.replace(/[^\d\:]/gi,"");var G=t.date(M[5].innerHTML);L.members[J]={i:D,r:K,s:H,p:O,c:P,d:G};var F=L.members[J];if(/NaN|undefined|null/.test(F.i+"")||(F.r)==null||typeof F.r=="undefined"||/NaN|undefined|null/.test(F.s+"")||/NaN|undefined|null/.test(F.p+"")||(!(/^\d+\:\d+\:\d+$/.test(F.c+"")))||(F.d)==null||typeof F.r=="undefined"){return false}}this.currentPageData=JSON.stringify(L);this.setNewList(this.currentPageData);return true},hideStatus:function(){this.statusRow.setAttribute("style","display:none")},showStatus:function(){this.statusRow.setAttribute("style","")},setErrorStatus:function(D){this.statusText.nodeValue="";this.statusLine.setAttribute("class","overmark");if(arguments.length>0){this.statusText.nodeValue=D}this.showStatus()},setOkStatus:function(D){this.statusText.nodeValue="";this.statusLine.setAttribute("class","undermark");if(arguments.length>0){this.statusText.nodeValue=D}this.showStatus()},setTitle:function(F,D,E){this[F+"Title"].setAttribute("class",(E)?"undermark":"overmark");this[F+"Title"].innerHTML=D},doIt:function(){v.doIt(this)}};var A=function(F){var H=this;this.section=j.createElement("div");this.section.setAttribute("class","section");var D=j.createElement("h3");var E=j.createElement("span");this.button=j.createElement("a");this.button.setAttribute("class","closed");this.button.setAttribute("href","javascript:void(0);");this.button.addEventListener("click",function(){H.toggle()},false);x.addText(E,i.name);this.button.appendChild(E);D.appendChild(this.button);this.section.appendChild(D);F.appendChild(this.section);this.sectioncontent=j.createElement("div");this.sectioncontent.setAttribute("class","sectioncontent");this.sectioncontent.setAttribute("id",i.name);this.sectioncontent.setAttribute("style","display:none;");this.content=j.createElement("div");this.content.setAttribute("class","contentz");var G=j.createElement("div");G.setAttribute("class","footer");this.sectioncontent.appendChild(this.content);this.sectioncontent.appendChild(G);F.appendChild(this.sectioncontent);this.form=null;this.canLoad=true;this.wTime=30;this.toggleTimer=null};var n=function(F){var D=0,E=0;if(F.offsetParent){do{D+=F.offsetLeft;E+=F.offsetTop}while(F=F.offsetParent)}return{l:D,t:E}};A.prototype={loadForm:function(){this.canLoad=false;if(!b.ready){this.wTime=Math.round(this.wTime*1.1);var D=this;setTimeout(function(){D.loadForm()},this.wTime);return}this.form=new p(this.content);this.form.setErrorStatus(C("e_nod"));if(!this.form.setNewListFromPage()){this.sectioncontent.innerHTML='<div style="color:red;text-align:center;font-weigth:bold;padding:30px">'+C("e_oga")+"</div>"}this.form.load();if(this.form.oldList.value==""){this.form.save("new");this.form.load()}},toggle:function(){if(this.canLoad){this.loadForm()}if(this.button.getAttribute("class")=="closed"){this.button.setAttribute("class","opened");this.sectioncontent.setAttribute("style","display:block;");var E=n(this.section);for(var D=10;D<=100;D+=30){setTimeout(function(){try{f.scroll(E.l,E.t)}catch(F){}},D)}}else{this.button.setAttribute("class","closed");this.sectioncontent.setAttribute("style","display:none;")}}};i.domWait=30;i.domLoader=function(){clearTimeout(this.domTimer);if(j.getElementById("allyInternText")){delete this.dom;this.dom=new A(j.getElementById("eins"))}else{this.domWait=Math.round(this.domWait*1.1);this.domTimer=setTimeout(function(){i.domLoader()},this.domWait)}};i.init=function(){this.domLoader();try{j.querySelector("a.navi.overview").addEventListener("click",function(){i.domWait=30;i.domLoader()},false);var D=j.querySelector("#form_assignRank a.save_bigger");if(D){D.addEventListener("click",function(){i.domWait=30;i.domTimer=setTimeout(function(){i.domLoader()},500)},false)}}catch(E){}};i.init()};var l=function(){if(arguments.callee.done){return}arguments.callee.done=true;if(c){clearInterval(c)}a()};if(j.addEventListener){j.addEventListener("DOMContentLoaded",l,false)}if(/WebKit/i.test(f.navigator.userAgent)){var c=setInterval(function(){if(/loaded|complete/.test(j.readyState)){l()}},10)}f.onload=l})();